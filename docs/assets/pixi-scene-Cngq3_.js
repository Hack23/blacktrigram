import{M as B,R as it,d as U,v as D,r as Vs,o as Ir,P as pt,u as At,O,e as E,B as N,p as Os,q as Hs,b as z,t as Ns,x as Lr,D as st,w as X,E as k,y as $s,z as js,A as qs,F as de,G as Ks,H as Qs,C as $,L as Js,I as ue,J as Zs,T as Wt,U as ti,K as ei,Q as ri,V as zt,S as si}from"./pixi-core-llF4J-.js";import{M as Qe,h as Wr,e as ut,a as F,I as Ce,t as zr,i as ii,j as ni,k as Yr,D as ai,l as gt,C as yt,f as Er,m as vt,n as J,U as mt,o as ee,p as Xr,q as Vr,r as Ue,s as re,S as xt,u as Or,v as oi,w as se,x as Hr,y as Nr,z as hi,E as ie,F as $r,H as li,c as Nt,B as ci,J as De,K as Pe,d as di,G as ui,R as jr}from"./pixi-rendering-BZGJ8-.js";import{E as ne,p as fi}from"./vendor-CmOGjt.js";import{F as Je}from"./pixi-filters-iiPwGG.js";function pi(s){const t={};for(const e in s)s[e]!==void 0&&(t[e]=s[e]);return t}const Ze=new B;class K{constructor(t=1/0,e=1/0,r=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Ze,this.minX=t,this.minY=e,this.maxX=r,this.maxY=i}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new it);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Ze,this}set(t,e,r,i){this.minX=t,this.minY=e,this.maxX=r,this.maxY=i}addFrame(t,e,r,i,n){n||(n=this.matrix);const a=n.a,o=n.b,h=n.c,c=n.d,l=n.tx,d=n.ty;let f=this.minX,u=this.minY,g=this.maxX,p=this.maxY,m=a*t+h*e+l,x=o*t+c*e+d;m<f&&(f=m),x<u&&(u=x),m>g&&(g=m),x>p&&(p=x),m=a*r+h*e+l,x=o*r+c*e+d,m<f&&(f=m),x<u&&(u=x),m>g&&(g=m),x>p&&(p=x),m=a*t+h*i+l,x=o*t+c*i+d,m<f&&(f=m),x<u&&(u=x),m>g&&(g=m),x>p&&(p=x),m=a*r+h*i+l,x=o*r+c*i+d,m<f&&(f=m),x<u&&(u=x),m>g&&(g=m),x>p&&(p=x),this.minX=f,this.minY=u,this.maxX=g,this.maxY=p}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,r=this.minY,i=this.maxX,n=this.maxY,{a,b:o,c:h,d:c,tx:l,ty:d}=t;let f=a*e+h*r+l,u=o*e+c*r+d;this.minX=f,this.minY=u,this.maxX=f,this.maxY=u,f=a*i+h*r+l,u=o*i+c*r+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY,f=a*e+h*n+l,u=o*e+c*n+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY,f=a*i+h*n+l,u=o*i+c*n+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,r,i){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<r&&(this.minY=r),this.maxY>i&&(this.maxY=i),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new K(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,r,i){let n=this.minX,a=this.minY,o=this.maxX,h=this.maxY;i||(i=this.matrix);const c=i.a,l=i.b,d=i.c,f=i.d,u=i.tx,g=i.ty;for(let p=e;p<r;p+=2){const m=t[p],x=t[p+1],_=c*m+d*x+u,T=l*m+f*x+g;n=_<n?_:n,a=T<a?T:a,o=_>o?_:o,h=T>h?T:h}this.minX=n,this.minY=a,this.maxX=o,this.maxY=h}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}const gi={get isCachedAsTexture(){return!!this.renderGroup?.isCachedAsTexture},cacheAsTexture(s){typeof s=="boolean"&&s===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(s===!0?{}:s))},updateCacheTexture(){this.renderGroup?.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(s){U("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(s)}},mi={allowChildren:!0,removeChildren(s=0,t){const e=t??this.children.length,r=e-s,i=[];if(r>0&&r<=e){for(let a=e-1;a>=s;a--){const o=this.children[a];o&&(i.push(o),o.parent=null)}Vs(this.children,s,e);const n=this.renderGroup||this.parentRenderGroup;n&&n.removeChildren(i);for(let a=0;a<i.length;++a){const o=i[a];o.parentRenderLayer?.detach(o),this.emit("childRemoved",o,this,a),i[a].emit("removed",this)}return i.length>0&&this._didViewChangeTick++,i}else if(r===0&&this.children.length===0)return i;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(s){const t=this.getChildAt(s);return this.removeChild(t)},getChildAt(s){if(s<0||s>=this.children.length)throw new Error(`getChildAt: Index (${s}) does not exist.`);return this.children[s]},setChildIndex(s,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(s),this.addChildAt(s,t)},getChildIndex(s){const t=this.children.indexOf(s);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(s,t){this.allowChildren||U(D,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${s}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(s.parent){const i=s.parent.children.indexOf(s);if(s.parent===this&&i===t)return s;i!==-1&&s.parent.children.splice(i,1)}t===e.length?e.push(s):e.splice(t,0,s),s.parent=this,s.didChange=!0,s._updateFlags=15;const r=this.renderGroup||this.parentRenderGroup;return r&&r.addChild(s),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",s,this,t),s.emit("added",this),s},swapChildren(s,t){if(s===t)return;const e=this.getChildIndex(s),r=this.getChildIndex(t);this.children[e]=t,this.children[r]=s;const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){this.parent?.removeChild(this)},reparentChild(...s){return s.length===1?this.reparentChildAt(s[0],this.children.length):(s.forEach(t=>this.reparentChildAt(t,this.children.length)),s[0])},reparentChildAt(s,t){if(s.parent===this)return this.setChildIndex(s,t),s;const e=s.worldTransform.clone();s.removeFromParent(),this.addChildAt(s,t);const r=this.worldTransform.clone();return r.invert(),e.prepend(r),s.setFromMatrix(e),s}},xi={collectRenderables(s,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(s,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,s):this.collectRenderablesWithEffects(s,t,e))},collectRenderablesSimple(s,t,e){const r=this.children,i=r.length;for(let n=0;n<i;n++)r[n].collectRenderables(s,t,e)},collectRenderablesWithEffects(s,t,e){const{renderPipes:r}=t;for(let i=0;i<this.effects.length;i++){const n=this.effects[i];r[n.pipe].push(n,this,s)}this.collectRenderablesSimple(s,t,e);for(let i=this.effects.length-1;i>=0;i--){const n=this.effects[i];r[n.pipe].pop(n,this,s)}}},_i={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const s=this.renderGroup||this.parentRenderGroup;s&&(s.structureDidChange=!0)},addEffect(s){this.effects.indexOf(s)===-1&&(this.effects.push(s),this.effects.sort((e,r)=>e.priority-r.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(s){const t=this.effects.indexOf(s);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(s){const t=this._maskEffect;t?.mask!==s&&(t&&(this.removeEffect(t),Qe.returnMaskEffect(t),this._maskEffect=null),s!=null&&(this._maskEffect=Qe.getMaskEffect(s),this.addEffect(this._maskEffect)))},get mask(){return this._maskEffect?.mask},setMask(s){this._maskOptions={...this._maskOptions,...s},s.mask&&(this.mask=s.mask),this._markStructureAsChanged()},set filters(s){!Array.isArray(s)&&s&&(s=[s]);const t=this._filterEffect||(this._filterEffect=new Je);s=s;const e=s?.length>0,r=t.filters?.length>0,i=e!==r;s=Array.isArray(s)?s.slice(0):s,t.filters=Object.freeze(s),i&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=s??null))},get filters(){return this._filterEffect?.filters},set filterArea(s){this._filterEffect||(this._filterEffect=new Je),this._filterEffect.filterArea=s},get filterArea(){return this._filterEffect?.filterArea}},yi={label:null,get name(){return U(D,"Container.name property has been removed, use Container.label instead"),this.label},set name(s){U(D,"Container.name property has been removed, use Container.label instead"),this.label=s},getChildByName(s,t=!1){return this.getChildByLabel(s,t)},getChildByLabel(s,t=!1){const e=this.children;for(let r=0;r<e.length;r++){const i=e[r];if(i.label===s||s instanceof RegExp&&s.test(i.label))return i}if(t)for(let r=0;r<e.length;r++){const n=e[r].getChildByLabel(s,!0);if(n)return n}return null},getChildrenByLabel(s,t=!1,e=[]){const r=this.children;for(let i=0;i<r.length;i++){const n=r[i];(n.label===s||s instanceof RegExp&&s.test(n.label))&&e.push(n)}if(t)for(let i=0;i<r.length;i++)r[i].getChildrenByLabel(s,!0,e);return e}},H=new Ir(B),ft=new Ir(K),bi=new B,wi={getFastGlobalBounds(s,t){t||(t=new K),t.clear(),this._getGlobalBoundsRecursive(!!s,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(s,t,e){let r=t;if(s&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const i=!!this.effects.length;if((this.renderGroup||i)&&(r=ft.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const a=this.bounds;r.addFrame(a.minX,a.minY,a.maxX,a.maxY,this.groupTransform)}const n=this.children;for(let a=0;a<n.length;a++)n[a]._getGlobalBoundsRecursive(s,r,e)}if(i){let n=!1;const a=this.renderGroup||this.parentRenderGroup;for(let o=0;o<this.effects.length;o++)this.effects[o].addBounds&&(n||(n=!0,r.applyMatrix(a.worldTransform)),this.effects[o].addBounds(r,!0));n&&(r.applyMatrix(a.worldTransform.copyTo(bi).invert()),t.addBounds(r,this.relativeGroupTransform)),t.addBounds(r),ft.return(r)}else this.renderGroup&&(t.addBounds(r,this.relativeGroupTransform),ft.return(r))}};function Ti(s,t,e){e.clear();let r,i;return s.parent?t?r=s.parent.worldTransform:(i=H.get().identity(),r=Ie(s,i)):r=B.IDENTITY,qr(s,e,r,t),i&&H.return(i),e.isValid||e.set(0,0,0,0),e}function qr(s,t,e,r){if(!s.visible||!s.measurable)return;let i;r?i=s.worldTransform:(s.updateLocalTransform(),i=H.get(),i.appendFrom(s.localTransform,e));const n=t,a=!!s.effects.length;if(a&&(t=ft.get().clear()),s.boundsArea)t.addRect(s.boundsArea,i);else{s.bounds&&(t.matrix=i,t.addBounds(s.bounds));for(let o=0;o<s.children.length;o++)qr(s.children[o],t,i,r)}if(a){for(let o=0;o<s.effects.length;o++)s.effects[o].addBounds?.(t);n.addBounds(t,B.IDENTITY),ft.return(t)}r||H.return(i)}function Ie(s,t){const e=s.parent;return e&&(Ie(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function Kr(s,t){if(s===16777215||!t)return t;if(t===16777215||!s)return s;const e=s>>16&255,r=s>>8&255,i=s&255,n=t>>16&255,a=t>>8&255,o=t&255,h=e*n/255|0,c=r*a/255|0,l=i*o/255|0;return(h<<16)+(c<<8)+l}const tr=16777215;function $t(s,t){return s===tr?t:t===tr?s:Kr(s,t)}function Vt(s){return((s&255)<<16)+(s&65280)+(s>>16&255)}const Si={getGlobalAlpha(s){if(s)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(s,t){if(t)return s.copyFrom(this.worldTransform);this.updateLocalTransform();const e=Ie(this,H.get().identity());return s.appendFrom(this.localTransform,e),H.return(e),s},getGlobalTint(s){if(s)return this.renderGroup?Vt(this.renderGroup.worldColor):this.parentRenderGroup?Vt($t(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=$t(t,e.localColor),e=e.parent;return Vt(t)}};function Ci(s,t,e){return t.clear(),e||(e=B.IDENTITY),Qr(s,t,e,s,!0),t.isValid||t.set(0,0,0,0),t}function Qr(s,t,e,r,i){let n;if(i)n=H.get(),n=e.copyTo(n);else{if(!s.visible||!s.measurable)return;s.updateLocalTransform();const h=s.localTransform;n=H.get(),n.appendFrom(h,e)}const a=t,o=!!s.effects.length;if(o&&(t=ft.get().clear()),s.boundsArea)t.addRect(s.boundsArea,n);else{s.renderPipeId&&(t.matrix=n,t.addBounds(s.bounds));const h=s.children;for(let c=0;c<h.length;c++)Qr(h[c],t,n,r,!1)}if(o){for(let h=0;h<s.effects.length;h++)s.effects[h].addLocalBounds?.(t,r);a.addBounds(t,B.IDENTITY),ft.return(t)}H.return(n)}function Jr(s,t){const e=s.children;for(let r=0;r<e.length;r++){const i=e[r],n=i.uid,a=(i._didViewChangeTick&65535)<<16|i._didContainerChangeTick&65535,o=t.index;(t.data[o]!==n||t.data[o+1]!==a)&&(t.data[t.index]=n,t.data[t.index+1]=a,t.didChange=!0),t.index=o+2,i.children.length&&Jr(i,t)}return t.didChange}const Pi=new B,Mi={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(s,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=s/t*e:this.scale.x=e},_setHeight(s,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=s/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new K});const s=this._localBoundsCacheData;return s.index=1,s.didChange=!1,s.data[0]!==this._didViewChangeTick&&(s.didChange=!0,s.data[0]=this._didViewChangeTick),Jr(this,s),s.didChange&&Ci(this,s.localBounds,Pi),s.localBounds},getBounds(s,t){return Ti(this,s,t||new K)}},vi={_onRender:null,set onRender(s){const t=this.renderGroup||this.parentRenderGroup;if(!s){this._onRender&&t?.removeOnRender(this),this._onRender=null;return}this._onRender||t?.addOnRender(this),this._onRender=s},get onRender(){return this._onRender}},ki={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(s){this._zIndex!==s&&(this._zIndex=s,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(Ri))}};function Ri(s,t){return s._zIndex-t._zIndex}const Bi={getGlobalPosition(s=new pt,t=!1){return this.parent?this.parent.toGlobal(this._position,s,t):(s.x=this._position.x,s.y=this._position.y),s},toGlobal(s,t,e=!1){const r=this.getGlobalTransform(H.get(),e);return t=r.apply(s,t),H.return(r),t},toLocal(s,t,e,r){t&&(s=t.toGlobal(s,e,r));const i=this.getGlobalTransform(H.get(),r);return e=i.applyInverse(s,e),H.return(i),e}};class Gi{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new B,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Wr,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let r=0;r<e.length;r++){const i=e[r];i._updateFlags=15,this.addChild(i)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(ut.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let r=0;r<e.length;r++)this.addChild(e[r])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let r=0;r<e.length;r++)this.removeChild(e[r])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let r=0;r<e.length;r++)this._getChildren(e[r],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const r=t.children;for(let i=0;i<r.length;i++)this._getChildren(r[i],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return(this._matrixDirty&1)===0?this._inverseWorldTransform:(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new B),this._inverseWorldTransform.copyFrom(this.worldTransform).invert())}get textureOffsetInverseTransform(){return(this._matrixDirty&2)===0?this._textureOffsetInverseTransform:(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new B),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y))}get inverseParentTextureTransform(){if((this._matrixDirty&4)===0)return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new B),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Ai(s,t,e={}){for(const r in t)!e[r]&&t[r]!==void 0&&(s[r]=t[r])}const fe=new O(null),pe=new O(null),ge=new O(null,1,1),jt=1,Le=2,kt=4;class Ft extends ne{constructor(t={}){super(),this.uid=At("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new B,this.relativeGroupTransform=new B,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new O(this,0,0),this._scale=ge,this._pivot=pe,this._skew=fe,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Ai(this,t,{children:!0,parent:!0,effects:!0}),t.children?.forEach(e=>this.addChild(e)),t.parent?.addChild(this)}static mixin(t){U("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),E.mixin(Ft,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||U(D,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let i=0;i<t.length;i++)this.addChild(t[i]);return t[0]}const e=t[0],r=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),r&&(r.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,r&&r.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let i=0;i<t.length;i++)this.removeChild(t[i]);return t[0]}const e=t[0],r=this.children.indexOf(e);return r>-1&&(this._didViewChangeTick++,this.children.splice(r,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,r),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),this.renderGroup=N.get(Gi,this),this.groupTransform=B.IDENTITY,t?.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t?.removeChild(this),N.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t?.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new B),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*Os}set angle(t){this.rotation=t*Hs}get pivot(){return this._pivot===pe&&(this._pivot=new O(this,0,0)),this._pivot}set pivot(t){this._pivot===pe&&(this._pivot=new O(this,0,0)),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===fe&&(this._skew=new O(this,0,0)),this._skew}set skew(t){this._skew===fe&&(this._skew=new O(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===ge&&(this._scale=new O(this,1,1)),this._scale}set scale(t){this._scale===ge&&(this._scale=new O(this,0,0)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const r=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,r.width),e!==void 0&&this._setHeight(e,r.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,r=this._scale,i=this._pivot,n=this._position,a=r._x,o=r._y,h=i._x,c=i._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*o,e.d=this._sy*o,e.tx=n._x-(h*e.a+c*e.c),e.ty=n._y-(h*e.b+c*e.d)}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=jt,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const r=z.shared.setValue(t??16777215).toBgrNumber();r!==this.localColor&&(this.localColor=r,this._updateFlags|=jt,this._onUpdate())}get tint(){return Vt(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Le,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=kt,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=kt,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=kt,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t?.children)&&e)for(let i=0;i<e.length;++i)e[i].destroy(t);this.renderGroup?.destroy(),this.renderGroup=null}}E.mixin(Ft,mi,wi,Bi,vi,Mi,_i,yi,ki,Ns,gi,Si,xi);class Ut extends Ft{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new K(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:r,y:i}=t;return r>=e.minX&&r<=e.maxX&&i>=e.minY&&i<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){super.destroy(t),this._bounds=null;for(const e in this._gpuData)this._gpuData[e].destroy?.();this._gpuData=null}collectRenderablesSimple(t,e,r){const{renderPipes:i}=e;i.blendMode.setBlendMode(this,this.groupBlendMode,t),i[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const a=this.children,o=a.length;for(let h=0;h<o;h++)a[h].collectRenderables(t,e,r)}}class qt extends Ut{constructor(t=F.EMPTY){t instanceof F&&(t={texture:t});const{texture:e=F.EMPTY,anchor:r,roundPixels:i,width:n,height:a,...o}=t;super({label:"Sprite",...o}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new O({_onUpdate:()=>{this.onViewUpdate()}}),r?this.anchor=r:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=i??!1,n!==void 0&&(this.width=n),a!==void 0&&(this.height=a)}static from(t,e=!1){return t instanceof F?new qt(t):new qt(F.from(t,e))}set texture(t){t||(t=F.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Lr(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return U("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,r=this._bounds,{width:i,height:n}=e.orig;r.minX=-t._x*i,r.maxX=r.minX+i,r.minY=-t._y*n,r.maxY=r.minY+n}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(r)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}class Zr extends ne{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return U(D,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return U(D,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return U(D,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return U(D,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return U(D,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(const e in this.chars)this.chars[e].texture?.destroy();this.chars=null,t&&(this.pages.forEach(e=>e.texture.destroy(!0)),this.pages=null)}}const Fi=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Kt(s){const t=typeof s.fontSize=="number"?`${s.fontSize}px`:s.fontSize;let e=s.fontFamily;Array.isArray(s.fontFamily)||(e=s.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let i=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!Fi.includes(i)&&(i=`"${i}"`),e[r]=i}return`${s.fontStyle} ${s.fontVariant} ${s.fontWeight} ${t} ${e.join(",")}`}const me={willReadFrequently:!0},tt=class v{static get experimentalLetterSpacingSupported(){let t=v._experimentalLetterSpacingSupported;if(t===void 0){const e=st.get().getCanvasRenderingContext2D().prototype;t=v._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,i,n,a,o,h,c){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=n,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=h,this.fontProperties=c}static measureText(t=" ",e,r=v._canvas,i=e.wordWrap){const n=Kt(e),a=v.measureFont(n);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const o=v.__context;o.font=n;const c=(i?v._wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),l=new Array(c.length);let d=0;for(let x=0;x<c.length;x++){const _=v._measureText(c[x],e.letterSpacing,o);l[x]=_,d=Math.max(d,_)}const f=e._stroke?.width||0;let u=d+f;e.dropShadow&&(u+=e.dropShadow.distance);const g=e.lineHeight||a.fontSize;let p=Math.max(g,a.fontSize+f)+(c.length-1)*(g+e.leading);return e.dropShadow&&(p+=e.dropShadow.distance),new v(t,e,u,p,c,l,g+e.leading,d,a)}static _measureText(t,e,r){let i=!1;v.experimentalLetterSpacingSupported&&(v.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,i=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));const n=r.measureText(t);let a=n.width;const o=-n.actualBoundingBoxLeft;let c=n.actualBoundingBoxRight-o;if(a>0)if(i)a-=e,c-=e;else{const l=(v.graphemeSegmenter(t).length-1)*e;a+=l,c+=l}return Math.max(a,c)}static _wordWrap(t,e,r=v._canvas){const i=r.getContext("2d",me);let n=0,a="",o="";const h=Object.create(null),{letterSpacing:c,whiteSpace:l}=e,d=v._collapseSpaces(l),f=v._collapseNewlines(l);let u=!d;const g=e.wordWrapWidth+c,p=v._tokenize(t);for(let m=0;m<p.length;m++){let x=p[m];if(v._isNewline(x)){if(!f){o+=v._addLine(a),u=!d,a="",n=0;continue}x=" "}if(d){const T=v.isBreakingSpace(x),w=v.isBreakingSpace(a[a.length-1]);if(T&&w)continue}const _=v._getFromCache(x,c,h,i);if(_>g)if(a!==""&&(o+=v._addLine(a),a="",n=0),v.canBreakWords(x,e.breakWords)){const T=v.wordWrapSplit(x);for(let w=0;w<T.length;w++){let S=T[w],b=S,y=1;for(;T[w+y];){const P=T[w+y];if(!v.canBreakChars(b,P,x,w,e.breakWords))S+=P;else break;b=P,y++}w+=y-1;const A=v._getFromCache(S,c,h,i);A+n>g&&(o+=v._addLine(a),u=!1,a="",n=0),a+=S,n+=A}}else{a.length>0&&(o+=v._addLine(a),a="",n=0);const T=m===p.length-1;o+=v._addLine(x,!T),u=!1,a="",n=0}else _+n>g&&(u=!1,o+=v._addLine(a),a="",n=0),(a.length>0||!v.isBreakingSpace(x)||u)&&(a+=x,n+=_)}return o+=v._addLine(a,!1),o}static _addLine(t,e=!0){return t=v._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,r,i){let n=r[t];return typeof n!="number"&&(n=v._measureText(t,e,i)+e,r[t]=n),n}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!v.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:v._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:v._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let i=0;i<t.length;i++){const n=t[i],a=t[i+1];if(v.isBreakingSpace(n,a)||v._isNewline(n)){r!==""&&(e.push(r),r=""),e.push(n);continue}r+=n}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,n){return!0}static wordWrapSplit(t){return v.graphemeSegmenter(t)}static measureFont(t){if(v._fonts[t])return v._fonts[t];const e=v._context;e.font=t;const r=e.measureText(v.METRICS_STRING+v.BASELINE_SYMBOL),i={ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,fontSize:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent};return v._fonts[t]=i,i}static clearMetrics(t=""){t?delete v._fonts[t]:v._fonts={}}static get _canvas(){if(!v.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",me)?.measureText)return v.__canvas=e,e;t=st.get().createCanvas()}catch{t=st.get().createCanvas()}t.width=t.height=10,v.__canvas=t}return v.__canvas}static get _context(){return v.__context||(v.__context=v._canvas.getContext("2d",me)),v.__context}};tt.METRICS_STRING="|ÉqÅ";tt.BASELINE_SYMBOL="M";tt.BASELINE_MULTIPLIER=1.4;tt.HEIGHT_MULTIPLIER=2;tt.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const s=new Intl.Segmenter;return t=>{const e=s.segment(t),r=[];let i=0;for(const n of e)r[i++]=n.segment;return r}}return s=>[...s]})();tt.experimentalLetterSpacing=!1;tt._fonts={};tt._newlines=[10,13];tt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let q=tt;const er=[{offset:0,color:"white"},{offset:1,color:"black"}],We=class Me{constructor(...t){this.uid=At("fillGradient"),this.type="linear",this.colorStops=[];let e=Ui(t);e={...e.type==="radial"?Me.defaultRadialOptions:Me.defaultLinearOptions,...pi(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(i=>{this.addColorStop(i.offset,i.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:z.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:r,y:i}=this.end,n=r-t,a=i-e;const o=n<0||a<0;if(this._wrapMode==="clamp-to-edge"){if(n<0){const m=t;t=r,r=m,n*=-1}if(a<0){const m=e;e=i,i=m,a*=-1}}const h=this.colorStops.length?this.colorStops:er,c=this._textureSize,{canvas:l,context:d}=sr(c,1),f=o?d.createLinearGradient(this._textureSize,0,0,0):d.createLinearGradient(0,0,this._textureSize,0);rr(f,h),d.fillStyle=f,d.fillRect(0,0,c,1),this.texture=new F({source:new Ce({resource:l,addressMode:this._wrapMode})});const u=Math.sqrt(n*n+a*a),g=Math.atan2(a,n),p=new B;p.scale(u/c,1),p.rotate(g),p.translate(t,e),this.textureSpace==="local"&&p.scale(c,c),this.transform=p}buildGradient(){this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:er,e=this._textureSize,{canvas:r,context:i}=sr(e,e),{x:n,y:a}=this.center,{x:o,y:h}=this.outerCenter,c=this.innerRadius,l=this.outerRadius,d=o-l,f=h-l,u=e/(l*2),g=(n-d)*u,p=(a-f)*u,m=i.createRadialGradient(g,p,c*u,(o-d)*u,(h-f)*u,l*u);rr(m,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=m,i.translate(g,p),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-g,-p),i.fillRect(0,0,e,e),this.texture=new F({source:new Ce({resource:r,addressMode:this._wrapMode})});const x=new B;x.scale(1/u,1/u),x.translate(d,f),this.textureSpace==="local"&&x.scale(e,e),this.transform=x}get styleKey(){return this.uid}destroy(){this.texture?.destroy(!0),this.texture=null}};We.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};We.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let et=We;function rr(s,t){for(let e=0;e<t.length;e++){const r=t[e];s.addColorStop(r.offset,r.color)}}function sr(s,t){const e=st.get().createCanvas(s,t),r=e.getContext("2d");return{canvas:e,context:r}}function Ui(s){let t=s[0]??{};return(typeof t=="number"||s[1])&&(U("8.5.2","use options object instead"),t={type:"linear",start:{x:s[0],y:s[1]},end:{x:s[2],y:s[3]},textureSpace:s[4],textureSize:s[5]??et.defaultLinearOptions.textureSize}),t}const ir={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class ae{constructor(t,e){this.uid=At("fillPattern"),this.transform=new B,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=ir[e].addressModeU,t.source.style.addressModeV=ir[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey?this._styleKey:(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`,this._styleKey)}}function Di(s,t){const e=fi(s),r=[];let i=null,n=0,a=0;for(let o=0;o<e.length;o++){const h=e[o],c=h[0],l=h;switch(c){case"M":n=l[1],a=l[2],t.moveTo(n,a);break;case"m":n+=l[1],a+=l[2],t.moveTo(n,a);break;case"H":n=l[1],t.lineTo(n,a);break;case"h":n+=l[1],t.lineTo(n,a);break;case"V":a=l[1],t.lineTo(n,a);break;case"v":a+=l[1],t.lineTo(n,a);break;case"L":n=l[1],a=l[2],t.lineTo(n,a);break;case"l":n+=l[1],a+=l[2],t.lineTo(n,a);break;case"C":n=l[5],a=l[6],t.bezierCurveTo(l[1],l[2],l[3],l[4],n,a);break;case"c":t.bezierCurveTo(n+l[1],a+l[2],n+l[3],a+l[4],n+l[5],a+l[6]),n+=l[5],a+=l[6];break;case"S":n=l[3],a=l[4],t.bezierCurveToShort(l[1],l[2],n,a);break;case"s":t.bezierCurveToShort(n+l[1],a+l[2],n+l[3],a+l[4]),n+=l[3],a+=l[4];break;case"Q":n=l[3],a=l[4],t.quadraticCurveTo(l[1],l[2],n,a);break;case"q":t.quadraticCurveTo(n+l[1],a+l[2],n+l[3],a+l[4]),n+=l[3],a+=l[4];break;case"T":n=l[1],a=l[2],t.quadraticCurveToShort(n,a);break;case"t":n+=l[1],a+=l[2],t.quadraticCurveToShort(n,a);break;case"A":n=l[6],a=l[7],t.arcToSvg(l[1],l[2],l[3],l[4],l[5],n,a);break;case"a":n+=l[6],a+=l[7],t.arcToSvg(l[1],l[2],l[3],l[4],l[5],n,a);break;case"Z":case"z":t.closePath(),r.length>0&&(i=r.pop(),i?(n=i.startX,a=i.startY):(n=0,a=0)),i=null;break;default:X(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&i===null&&(i={startX:n,startY:a},r.push(i))}return t}const Ii=new B;class ze{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,r=this.renderable;return r?Kr(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){return this.renderable?.groupTransform||Ii}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const Gt={extension:{type:k.ShapeBuilder,name:"circle"},build(s,t){let e,r,i,n,a,o;if(s.type==="circle"){const w=s;if(a=o=w.radius,a<=0)return!1;e=w.x,r=w.y,i=n=0}else if(s.type==="ellipse"){const w=s;if(a=w.halfWidth,o=w.halfHeight,a<=0||o<=0)return!1;e=w.x,r=w.y,i=n=0}else{const w=s,S=w.width/2,b=w.height/2;e=w.x+S,r=w.y+b,a=o=Math.max(0,Math.min(w.radius,Math.min(S,b))),i=S-a,n=b-o}if(i<0||n<0)return!1;const h=Math.ceil(2.3*Math.sqrt(a+o)),c=h*8+(i?4:0)+(n?4:0);if(c===0)return!1;if(h===0)return t[0]=t[6]=e+i,t[1]=t[3]=r+n,t[2]=t[4]=e-i,t[5]=t[7]=r-n,!0;let l=0,d=h*4+(i?2:0)+2,f=d,u=c,g=i+a,p=n,m=e+g,x=e-g,_=r+p;if(t[l++]=m,t[l++]=_,t[--d]=_,t[--d]=x,n){const w=r-p;t[f++]=x,t[f++]=w,t[--u]=w,t[--u]=m}for(let w=1;w<h;w++){const S=Math.PI/2*(w/h),b=i+Math.cos(S)*a,y=n+Math.sin(S)*o,A=e+b,P=e-b,C=r+y,M=r-y;t[l++]=A,t[l++]=C,t[--d]=C,t[--d]=P,t[f++]=P,t[f++]=M,t[--u]=M,t[--u]=A}g=i,p=n+o,m=e+g,x=e-g,_=r+p;const T=r-p;return t[l++]=m,t[l++]=_,t[--u]=T,t[--u]=m,i&&(t[l++]=x,t[l++]=_,t[--u]=T,t[--u]=x),!0},triangulate(s,t,e,r,i,n){if(s.length===0)return;let a=0,o=0;for(let l=0;l<s.length;l+=2)a+=s[l],o+=s[l+1];a/=s.length/2,o/=s.length/2;let h=r;t[h*e]=a,t[h*e+1]=o;const c=h++;for(let l=0;l<s.length;l+=2)t[h*e]=s[l],t[h*e+1]=s[l+1],l>0&&(i[n++]=h,i[n++]=c,i[n++]=h-1),h++;i[n++]=c+1,i[n++]=c,i[n++]=h-1}},Li={...Gt,extension:{...Gt.extension,name:"ellipse"}},Wi={...Gt,extension:{...Gt.extension,name:"roundedRectangle"}},ts=1e-4,nr=1e-4;function zi(s){const t=s.length;if(t<6)return 1;let e=0;for(let r=0,i=s[t-2],n=s[t-1];r<t;r+=2){const a=s[r],o=s[r+1];e+=(a-i)*(o+n),i=a,n=o}return e<0?-1:1}function ar(s,t,e,r,i,n,a,o){const h=s-e*i,c=t-r*i,l=s+e*n,d=t+r*n;let f,u;a?(f=r,u=-e):(f=-r,u=e);const g=h+f,p=c+u,m=l+f,x=d+u;return o.push(g,p),o.push(m,x),2}function lt(s,t,e,r,i,n,a,o){const h=e-s,c=r-t;let l=Math.atan2(h,c),d=Math.atan2(i-s,n-t);o&&l<d?l+=Math.PI*2:!o&&l>d&&(d+=Math.PI*2);let f=l;const u=d-l,g=Math.abs(u),p=Math.sqrt(h*h+c*c),m=(15*g*Math.sqrt(p)/Math.PI>>0)+1,x=u/m;if(f+=x,o){a.push(s,t),a.push(e,r);for(let _=1,T=f;_<m;_++,T+=x)a.push(s,t),a.push(s+Math.sin(T)*p,t+Math.cos(T)*p);a.push(s,t),a.push(i,n)}else{a.push(e,r),a.push(s,t);for(let _=1,T=f;_<m;_++,T+=x)a.push(s+Math.sin(T)*p,t+Math.cos(T)*p),a.push(s,t);a.push(i,n),a.push(s,t)}return m*2}function Yi(s,t,e,r,i,n){const a=ts;if(s.length===0)return;const o=t;let h=o.alignment;if(t.alignment!==.5){let L=zi(s);h=(h-.5)*L+.5}const c=new pt(s[0],s[1]),l=new pt(s[s.length-2],s[s.length-1]),d=r,f=Math.abs(c.x-l.x)<a&&Math.abs(c.y-l.y)<a;if(d){s=s.slice(),f&&(s.pop(),s.pop(),l.set(s[s.length-2],s[s.length-1]));const L=(c.x+l.x)*.5,rt=(l.y+c.y)*.5;s.unshift(L,rt),s.push(L,rt)}const u=i,g=s.length/2;let p=s.length;const m=u.length/2,x=o.width/2,_=x*x,T=o.miterLimit*o.miterLimit;let w=s[0],S=s[1],b=s[2],y=s[3],A=0,P=0,C=-(S-y),M=w-b,W=0,I=0,V=Math.sqrt(C*C+M*M);C/=V,M/=V,C*=x,M*=x;const wt=h,R=(1-wt)*2,G=wt*2;d||(o.cap==="round"?p+=lt(w-C*(R-G)*.5,S-M*(R-G)*.5,w-C*R,S-M*R,w+C*G,S+M*G,u,!0)+2:o.cap==="square"&&(p+=ar(w,S,C,M,R,G,!0,u))),u.push(w-C*R,S-M*R),u.push(w+C*G,S+M*G);for(let L=1;L<g-1;++L){w=s[(L-1)*2],S=s[(L-1)*2+1],b=s[L*2],y=s[L*2+1],A=s[(L+1)*2],P=s[(L+1)*2+1],C=-(S-y),M=w-b,V=Math.sqrt(C*C+M*M),C/=V,M/=V,C*=x,M*=x,W=-(y-P),I=b-A,V=Math.sqrt(W*W+I*I),W/=V,I/=V,W*=x,I*=x;const rt=b-w,Tt=S-y,St=b-A,Ct=P-y,$e=rt*St+Tt*Ct,Dt=Tt*St-Ct*rt,Pt=Dt<0;if(Math.abs(Dt)<.001*Math.abs($e)){u.push(b-C*R,y-M*R),u.push(b+C*G,y+M*G),$e>=0&&(o.join==="round"?p+=lt(b,y,b-C*R,y-M*R,b-W*R,y-I*R,u,!1)+4:p+=2,u.push(b-W*G,y-I*G),u.push(b+W*R,y+I*R));continue}const je=(-C+w)*(-M+y)-(-C+b)*(-M+S),qe=(-W+A)*(-I+y)-(-W+b)*(-I+P),It=(rt*qe-St*je)/Dt,Lt=(Ct*je-Tt*qe)/Dt,ce=(It-b)*(It-b)+(Lt-y)*(Lt-y),nt=b+(It-b)*R,at=y+(Lt-y)*R,ot=b-(It-b)*G,ht=y-(Lt-y)*G,Es=Math.min(rt*rt+Tt*Tt,St*St+Ct*Ct),Ke=Pt?R:G,Xs=Es+Ke*Ke*_;ce<=Xs?o.join==="bevel"||ce/_>T?(Pt?(u.push(nt,at),u.push(b+C*G,y+M*G),u.push(nt,at),u.push(b+W*G,y+I*G)):(u.push(b-C*R,y-M*R),u.push(ot,ht),u.push(b-W*R,y-I*R),u.push(ot,ht)),p+=2):o.join==="round"?Pt?(u.push(nt,at),u.push(b+C*G,y+M*G),p+=lt(b,y,b+C*G,y+M*G,b+W*G,y+I*G,u,!0)+4,u.push(nt,at),u.push(b+W*G,y+I*G)):(u.push(b-C*R,y-M*R),u.push(ot,ht),p+=lt(b,y,b-C*R,y-M*R,b-W*R,y-I*R,u,!1)+4,u.push(b-W*R,y-I*R),u.push(ot,ht)):(u.push(nt,at),u.push(ot,ht)):(u.push(b-C*R,y-M*R),u.push(b+C*G,y+M*G),o.join==="round"?Pt?p+=lt(b,y,b+C*G,y+M*G,b+W*G,y+I*G,u,!0)+2:p+=lt(b,y,b-C*R,y-M*R,b-W*R,y-I*R,u,!1)+2:o.join==="miter"&&ce/_<=T&&(Pt?(u.push(ot,ht),u.push(ot,ht)):(u.push(nt,at),u.push(nt,at)),p+=2),u.push(b-W*R,y-I*R),u.push(b+W*G,y+I*G),p+=2)}w=s[(g-2)*2],S=s[(g-2)*2+1],b=s[(g-1)*2],y=s[(g-1)*2+1],C=-(S-y),M=w-b,V=Math.sqrt(C*C+M*M),C/=V,M/=V,C*=x,M*=x,u.push(b-C*R,y-M*R),u.push(b+C*G,y+M*G),d||(o.cap==="round"?p+=lt(b-C*(R-G)*.5,y-M*(R-G)*.5,b-C*R,y-M*R,b+C*G,y+M*G,u,!1)+2:o.cap==="square"&&(p+=ar(b,y,C,M,R,G,!1,u)));const Ys=nr*nr;for(let L=m;L<p+m-2;++L)w=u[L*2],S=u[L*2+1],b=u[(L+1)*2],y=u[(L+1)*2+1],A=u[(L+2)*2],P=u[(L+2)*2+1],!(Math.abs(w*(y-P)+b*(P-S)+A*(S-y))<Ys)&&n.push(L,L+1,L+2)}function Ei(s,t,e,r){const i=ts;if(s.length===0)return;const n=s[0],a=s[1],o=s[s.length-2],h=s[s.length-1],c=t||Math.abs(n-o)<i&&Math.abs(a-h)<i,l=e,d=s.length/2,f=l.length/2;for(let u=0;u<d;u++)l.push(s[u*2]),l.push(s[u*2+1]);for(let u=0;u<d-1;u++)r.push(f+u,f+u+1);c&&r.push(f+d-1,f)}function es(s,t,e,r,i,n,a){const o=$s(s,t,2);if(!o)return;for(let c=0;c<o.length;c+=3)n[a++]=o[c]+i,n[a++]=o[c+1]+i,n[a++]=o[c+2]+i;let h=i*r;for(let c=0;c<s.length;c+=2)e[h]=s[c],e[h+1]=s[c+1],h+=r}const Xi=[],Vi={extension:{type:k.ShapeBuilder,name:"polygon"},build(s,t){for(let e=0;e<s.points.length;e++)t[e]=s.points[e];return!0},triangulate(s,t,e,r,i,n){es(s,Xi,t,e,r,i,n)}},Oi={extension:{type:k.ShapeBuilder,name:"rectangle"},build(s,t){const e=s,r=e.x,i=e.y,n=e.width,a=e.height;return n>0&&a>0?(t[0]=r,t[1]=i,t[2]=r+n,t[3]=i,t[4]=r+n,t[5]=i+a,t[6]=r,t[7]=i+a,!0):!1},triangulate(s,t,e,r,i,n){let a=0;r*=e,t[r+a]=s[0],t[r+a+1]=s[1],a+=e,t[r+a]=s[2],t[r+a+1]=s[3],a+=e,t[r+a]=s[6],t[r+a+1]=s[7],a+=e,t[r+a]=s[4],t[r+a+1]=s[5],a+=e;const o=r/e;i[n++]=o,i[n++]=o+1,i[n++]=o+2,i[n++]=o+1,i[n++]=o+3,i[n++]=o+2}},Hi={extension:{type:k.ShapeBuilder,name:"triangle"},build(s,t){return t[0]=s.x,t[1]=s.y,t[2]=s.x2,t[3]=s.y2,t[4]=s.x3,t[5]=s.y3,!0},triangulate(s,t,e,r,i,n){let a=0;r*=e,t[r+a]=s[0],t[r+a+1]=s[1],a+=e,t[r+a]=s[2],t[r+a+1]=s[3],a+=e,t[r+a]=s[4],t[r+a+1]=s[5];const o=r/e;i[n++]=o,i[n++]=o+1,i[n++]=o+2}},Ni=new B,$i=new it;function ji(s,t,e,r){const i=t.matrix?s.copyFrom(t.matrix).invert():s.identity();if(t.textureSpace==="local"){const a=e.getBounds($i);t.width&&a.pad(t.width);const{x:o,y:h}=a,c=1/a.width,l=1/a.height,d=-o*c,f=-h*l,u=i.a,g=i.b,p=i.c,m=i.d;i.a*=c,i.b*=c,i.c*=l,i.d*=l,i.tx=d*u+f*p+i.tx,i.ty=d*g+f*m+i.ty}else i.translate(t.texture.frame.x,t.texture.frame.y),i.scale(1/t.texture.source.width,1/t.texture.source.height);const n=t.texture.source.style;return!(t.fill instanceof et)&&n.addressMode==="clamp-to-edge"&&(n.addressMode="repeat",n.update()),r&&i.append(Ni.copyFrom(r).invert()),i}const oe={};E.handleByMap(k.ShapeBuilder,oe);E.add(Oi,Vi,Hi,Gt,Li,Wi);const qi=new it,Ki=new B;function Qi(s,t){const{geometryData:e,batches:r}=t;r.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let i=0;i<s.instructions.length;i++){const n=s.instructions[i];if(n.action==="texture")Ji(n.data,r,e);else if(n.action==="fill"||n.action==="stroke"){const a=n.action==="stroke",o=n.data.path.shapePath,h=n.data.style,c=n.data.hole;a&&c&&or(c.shapePath,h,!0,r,e),c&&(o.shapePrimitives[o.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),or(o,h,a,r,e)}}}function Ji(s,t,e){const r=[],i=oe.rectangle,n=qi;n.x=s.dx,n.y=s.dy,n.width=s.dw,n.height=s.dh;const a=s.transform;if(!i.build(n,r))return;const{vertices:o,uvs:h,indices:c}=e,l=c.length,d=o.length/2;a&&zr(r,a),i.triangulate(r,o,2,d,c,l);const f=s.image,u=f.uvs;h.push(u.x0,u.y0,u.x1,u.y1,u.x3,u.y3,u.x2,u.y2);const g=N.get(ze);g.indexOffset=l,g.indexSize=c.length-l,g.attributeOffset=d,g.attributeSize=o.length/2-d,g.baseColor=s.style,g.alpha=s.alpha,g.texture=f,g.geometryData=e,t.push(g)}function or(s,t,e,r,i){const{vertices:n,uvs:a,indices:o}=i;s.shapePrimitives.forEach(({shape:h,transform:c,holes:l})=>{const d=[],f=oe[h.type];if(!f.build(h,d))return;const u=o.length,g=n.length/2;let p="triangle-list";if(c&&zr(d,c),e){const T=h.closePath??!0,w=t;w.pixelLine?(Ei(d,T,n,o),p="line-list"):Yi(d,w,!1,T,n,o)}else if(l){const T=[],w=d.slice();Zi(l).forEach(b=>{T.push(w.length/2),w.push(...b)}),es(w,T,n,2,g,o,u)}else f.triangulate(d,n,2,g,o,u);const m=a.length/2,x=t.texture;if(x!==F.WHITE){const T=ji(Ki,t,h,c);ii(n,2,g,a,m,2,n.length/2-g,T)}else ni(a,m,2,n.length/2-g);const _=N.get(ze);_.indexOffset=u,_.indexSize=o.length-u,_.attributeOffset=g,_.attributeSize=n.length/2-g,_.baseColor=t.color,_.alpha=t.alpha,_.texture=x,_.geometryData=i,_.topology=p,r.push(_)})}function Zi(s){const t=[];for(let e=0;e<s.length;e++){const r=s[e].shape,i=[];oe[r.type].build(r,i)&&t.push(i)}return t}class tn{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class en{constructor(){this.instructions=new Wr}init(t){this.batcher=new ai({maxTextures:t}),this.instructions.reset()}get geometry(){return U(js,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const Ye=class ve{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){ve.defaultOptions.bezierSmoothness=t?.bezierSmoothness??ve.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Qi(t,e);const r=t.batchMode;t.customShader||r==="no-batch"?e.isBatchable=!1:r==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=N.get(en,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:r,geometryData:i}=this._gpuContextHash[t.uid],n=i.vertices.length,a=i.indices.length;for(let l=0;l<r.length;l++)r[l].applyTransform=!1;const o=e.batcher;o.ensureAttributeBuffer(n),o.ensureIndexBuffer(a),o.begin();for(let l=0;l<r.length;l++){const d=r[l];o.add(d)}o.finish(e.instructions);const h=o.geometry;h.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),h.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const c=o.batches;for(let l=0;l<c.length;l++){const d=c[l];d.bindGroup=Yr(d.textures.textures,d.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new tn;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(N.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(r=>{N.return(r)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};Ye.extension={type:[k.WebGLSystem,k.WebGPUSystem,k.CanvasSystem],name:"graphicsContext"};Ye.defaultOptions={bezierSmoothness:.5};let Ee=Ye;const rn=8,Yt=11920929e-14,sn=1;function rs(s,t,e,r,i,n,a,o,h,c){const d=Math.min(.99,Math.max(0,c??Ee.defaultOptions.bezierSmoothness));let f=(sn-d)/1;return f*=f,nn(t,e,r,i,n,a,o,h,s,f),s}function nn(s,t,e,r,i,n,a,o,h,c){ke(s,t,e,r,i,n,a,o,h,c,0),h.push(a,o)}function ke(s,t,e,r,i,n,a,o,h,c,l){if(l>rn)return;const d=(s+e)/2,f=(t+r)/2,u=(e+i)/2,g=(r+n)/2,p=(i+a)/2,m=(n+o)/2,x=(d+u)/2,_=(f+g)/2,T=(u+p)/2,w=(g+m)/2,S=(x+T)/2,b=(_+w)/2;if(l>0){let y=a-s,A=o-t;const P=Math.abs((e-a)*A-(r-o)*y),C=Math.abs((i-a)*A-(n-o)*y);if(P>Yt&&C>Yt){if((P+C)*(P+C)<=c*(y*y+A*A)){h.push(S,b);return}}else if(P>Yt){if(P*P<=c*(y*y+A*A)){h.push(S,b);return}}else if(C>Yt){if(C*C<=c*(y*y+A*A)){h.push(S,b);return}}else if(y=S-(s+a)/2,A=b-(t+o)/2,y*y+A*A<=c){h.push(S,b);return}}ke(s,t,d,f,x,_,S,b,h,c,l+1),ke(S,b,T,w,p,m,a,o,h,c,l+1)}const an=8,on=11920929e-14,hn=1;function ln(s,t,e,r,i,n,a,o){const c=Math.min(.99,Math.max(0,o??Ee.defaultOptions.bezierSmoothness));let l=(hn-c)/1;return l*=l,cn(t,e,r,i,n,a,s,l),s}function cn(s,t,e,r,i,n,a,o){Re(a,s,t,e,r,i,n,o,0),a.push(i,n)}function Re(s,t,e,r,i,n,a,o,h){if(h>an)return;const c=(t+r)/2,l=(e+i)/2,d=(r+n)/2,f=(i+a)/2,u=(c+d)/2,g=(l+f)/2;let p=n-t,m=a-e;const x=Math.abs((r-n)*m-(i-a)*p);if(x>on){if(x*x<=o*(p*p+m*m)){s.push(u,g);return}}else if(p=u-(t+n)/2,m=g-(e+a)/2,p*p+m*m<=o){s.push(u,g);return}Re(s,t,e,c,l,u,g,o,h+1),Re(s,u,g,d,f,n,a,o,h+1)}function ss(s,t,e,r,i,n,a,o){let h=Math.abs(i-n);(!a&&i>n||a&&n>i)&&(h=2*Math.PI-h),o||(o=Math.max(6,Math.floor(6*Math.pow(r,1/3)*(h/Math.PI)))),o=Math.max(o,3);let c=h/o,l=i;c*=a?-1:1;for(let d=0;d<o+1;d++){const f=Math.cos(l),u=Math.sin(l),g=t+f*r,p=e+u*r;s.push(g,p),l+=c}}function dn(s,t,e,r,i,n){const a=s[s.length-2],h=s[s.length-1]-e,c=a-t,l=i-e,d=r-t,f=Math.abs(h*d-c*l);if(f<1e-8||n===0){(s[s.length-2]!==t||s[s.length-1]!==e)&&s.push(t,e);return}const u=h*h+c*c,g=l*l+d*d,p=h*l+c*d,m=n*Math.sqrt(u)/f,x=n*Math.sqrt(g)/f,_=m*p/u,T=x*p/g,w=m*d+x*c,S=m*l+x*h,b=c*(x+_),y=h*(x+_),A=d*(m+T),P=l*(m+T),C=Math.atan2(y-S,b-w),M=Math.atan2(P-S,A-w);ss(s,w+t,S+e,n,C,M,c*l>d*h)}const Rt=Math.PI*2,xe={centerX:0,centerY:0,ang1:0,ang2:0},_e=({x:s,y:t},e,r,i,n,a,o,h)=>{s*=e,t*=r;const c=i*s-n*t,l=n*s+i*t;return h.x=c+a,h.y=l+o,h};function un(s,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=t===1.5707963267948966?.551915024494:e,i=Math.cos(s),n=Math.sin(s),a=Math.cos(s+t),o=Math.sin(s+t);return[{x:i-n*r,y:n+i*r},{x:a+o*r,y:o-a*r},{x:a,y:o}]}const hr=(s,t,e,r)=>{const i=s*r-t*e<0?-1:1;let n=s*e+t*r;return n>1&&(n=1),n<-1&&(n=-1),i*Math.acos(n)},fn=(s,t,e,r,i,n,a,o,h,c,l,d,f)=>{const u=Math.pow(i,2),g=Math.pow(n,2),p=Math.pow(l,2),m=Math.pow(d,2);let x=u*g-u*m-g*p;x<0&&(x=0),x/=u*m+g*p,x=Math.sqrt(x)*(a===o?-1:1);const _=x*i/n*d,T=x*-n/i*l,w=c*_-h*T+(s+e)/2,S=h*_+c*T+(t+r)/2,b=(l-_)/i,y=(d-T)/n,A=(-l-_)/i,P=(-d-T)/n,C=hr(1,0,b,y);let M=hr(b,y,A,P);o===0&&M>0&&(M-=Rt),o===1&&M<0&&(M+=Rt),f.centerX=w,f.centerY=S,f.ang1=C,f.ang2=M};function pn(s,t,e,r,i,n,a,o=0,h=0,c=0){if(n===0||a===0)return;const l=Math.sin(o*Rt/360),d=Math.cos(o*Rt/360),f=d*(t-r)/2+l*(e-i)/2,u=-l*(t-r)/2+d*(e-i)/2;if(f===0&&u===0)return;n=Math.abs(n),a=Math.abs(a);const g=Math.pow(f,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(a,2);g>1&&(n*=Math.sqrt(g),a*=Math.sqrt(g)),fn(t,e,r,i,n,a,h,c,l,d,f,u,xe);let{ang1:p,ang2:m}=xe;const{centerX:x,centerY:_}=xe;let T=Math.abs(m)/(Rt/4);Math.abs(1-T)<1e-7&&(T=1);const w=Math.max(Math.ceil(T),1);m/=w;let S=s[s.length-2],b=s[s.length-1];const y={x:0,y:0};for(let A=0;A<w;A++){const P=un(p,m),{x:C,y:M}=_e(P[0],n,a,d,l,x,_,y),{x:W,y:I}=_e(P[1],n,a,d,l,x,_,y),{x:V,y:wt}=_e(P[2],n,a,d,l,x,_,y);rs(s,S,b,C,M,W,I,V,wt),S=V,b=wt,p+=m}}function gn(s,t,e){const r=(a,o)=>{const h=o.x-a.x,c=o.y-a.y,l=Math.sqrt(h*h+c*c),d=h/l,f=c/l;return{len:l,nx:d,ny:f}},i=(a,o)=>{a===0?s.moveTo(o.x,o.y):s.lineTo(o.x,o.y)};let n=t[t.length-1];for(let a=0;a<t.length;a++){const o=t[a%t.length],h=o.radius??e;if(h<=0){i(a,o),n=o;continue}const c=t[(a+1)%t.length],l=r(o,n),d=r(o,c);if(l.len<1e-4||d.len<1e-4){i(a,o),n=o;continue}let f=Math.asin(l.nx*d.ny-l.ny*d.nx),u=1,g=!1;l.nx*d.nx-l.ny*-d.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,u=-1,g=!0):f>0&&(u=-1,g=!0);const p=f/2;let m,x=Math.abs(Math.cos(p)*h/Math.sin(p));x>Math.min(l.len/2,d.len/2)?(x=Math.min(l.len/2,d.len/2),m=Math.abs(x*Math.sin(p)/Math.cos(p))):m=h;const _=o.x+d.nx*x+-d.ny*m*u,T=o.y+d.ny*x+d.nx*m*u,w=Math.atan2(l.ny,l.nx)+Math.PI/2*u,S=Math.atan2(d.ny,d.nx)-Math.PI/2*u;a===0&&s.moveTo(_+Math.cos(w)*m,T+Math.sin(w)*m),s.arc(_,T,m,w,S,g),n=o}}function mn(s,t,e,r){const i=(o,h)=>Math.sqrt((o.x-h.x)**2+(o.y-h.y)**2),n=(o,h,c)=>({x:o.x+(h.x-o.x)*c,y:o.y+(h.y-o.y)*c}),a=t.length;for(let o=0;o<a;o++){const h=t[(o+1)%a],c=h.radius??e;if(c<=0){o===0?s.moveTo(h.x,h.y):s.lineTo(h.x,h.y);continue}const l=t[o],d=t[(o+2)%a],f=i(l,h);let u;if(f<1e-4)u=h;else{const m=Math.min(f/2,c);u=n(h,l,m/f)}const g=i(d,h);let p;if(g<1e-4)p=h;else{const m=Math.min(g/2,c);p=n(h,d,m/g)}o===0?s.moveTo(u.x,u.y):s.lineTo(u.x,u.y),s.quadraticCurveTo(h.x,h.y,p.x,p.y,r)}}const xn=new it;class _n{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new K,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const r=this._currentPoly.points,i=r[r.length-2],n=r[r.length-1];return(i!==t||n!==e)&&r.push(t,e),this}arc(t,e,r,i,n,a){this._ensurePoly(!1);const o=this._currentPoly.points;return ss(o,t,e,r,i,n,a),this}arcTo(t,e,r,i,n){this._ensurePoly();const a=this._currentPoly.points;return dn(a,t,e,r,i,n),this}arcToSvg(t,e,r,i,n,a,o){const h=this._currentPoly.points;return pn(h,this._currentPoly.lastX,this._currentPoly.lastY,a,o,t,e,r,i,n),this}bezierCurveTo(t,e,r,i,n,a,o){this._ensurePoly();const h=this._currentPoly;return rs(this._currentPoly.points,h.lastX,h.lastY,t,e,r,i,n,a,o),this}quadraticCurveTo(t,e,r,i,n){this._ensurePoly();const a=this._currentPoly;return ln(this._currentPoly.points,a.lastX,a.lastY,t,e,r,i,n),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const r=this.shapePrimitives,i=r.length;for(let n=0;n<t.instructions.length;n++){const a=t.instructions[n];this[a.action](...a.data)}if(t.checkForHoles&&r.length-i>1){let n=null;for(let a=i;a<r.length;a++){const o=r[a];if(o.shape.type==="polygon"){const h=o.shape,c=n?.shape;c&&c.containsPolygon(h)?(n.holes||(n.holes=[]),n.holes.push(o),r.copyWithin(a,a+1),r.length--,a--):n=o}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,r,i,n){return this.drawShape(new it(t,e,r,i),n),this}circle(t,e,r,i){return this.drawShape(new qs(t,e,r),i),this}poly(t,e,r){const i=new de(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i,n=0,a){i=Math.max(i|0,3);const o=-1*Math.PI/2+n,h=Math.PI*2/i,c=[];for(let l=0;l<i;l++){const d=o-l*h;c.push(t+r*Math.cos(d),e+r*Math.sin(d))}return this.poly(c,!0,a),this}roundPoly(t,e,r,i,n,a=0,o){if(i=Math.max(i|0,3),n<=0)return this.regularPoly(t,e,r,i,a);const h=r*Math.sin(Math.PI/i)-.001;n=Math.min(n,h);const c=-1*Math.PI/2+a,l=Math.PI*2/i,d=(i-2)*Math.PI/i/2;for(let f=0;f<i;f++){const u=f*l+c,g=t+r*Math.cos(u),p=e+r*Math.sin(u),m=u+Math.PI+d,x=u-Math.PI-d,_=g+n*Math.cos(m),T=p+n*Math.sin(m),w=g+n*Math.cos(x),S=p+n*Math.sin(x);f===0?this.moveTo(_,T):this.lineTo(_,T),this.quadraticCurveTo(g,p,w,S,o)}return this.closePath()}roundShape(t,e,r=!1,i){return t.length<3?this:(r?mn(this,t,e,i):gn(this,t,e),this.closePath())}filletRect(t,e,r,i,n){if(n===0)return this.rect(t,e,r,i);const a=Math.min(r,i)/2,o=Math.min(a,Math.max(-a,n)),h=t+r,c=e+i,l=o<0?-o:0,d=Math.abs(o);return this.moveTo(t,e+d).arcTo(t+l,e+l,t+d,e,d).lineTo(h-d,e).arcTo(h-l,e+l,h,e+d,d).lineTo(h,c-d).arcTo(h-l,c-l,t+r-d,c,d).lineTo(t+d,c).arcTo(t+l,c-l,t,c-d,d).closePath()}chamferRect(t,e,r,i,n,a){if(n<=0)return this.rect(t,e,r,i);const o=Math.min(n,Math.min(r,i)/2),h=t+r,c=e+i,l=[t+o,e,h-o,e,h,e+o,h,c-o,h-o,c,t+o,c,t,c-o,t,e+o];for(let d=l.length-1;d>=2;d-=2)l[d]===l[d-2]&&l[d-1]===l[d-3]&&l.splice(d-1,2);return this.poly(l,!0,a)}ellipse(t,e,r,i,n){return this.drawShape(new Ks(t,e,r,i),n),this}roundRect(t,e,r,i,n,a){return this.drawShape(new Qs(t,e,r,i,n),a),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),r=new de,r.points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new de,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let r=e.shape.x,i=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const n=e.transform,a=r;r=n.a*r+n.c*i+n.tx,i=n.b*a+n.d*i+n.ty}this._currentPoly.points.push(r,i)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let r=0;r<e.length;r++){const i=e[r],n=i.shape.getBounds(xn);i.transform?t.addRect(n,i.transform):t.addRect(n)}return t}}class bt{constructor(t,e=!1){this.instructions=[],this.uid=At("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?Di(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new _n(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,r,i,n){const a=this.instructions[this.instructions.length-1],o=this.getLastPoint(pt.shared);let h=0,c=0;if(!a||a.action!=="bezierCurveTo")h=o.x,c=o.y;else{h=a.data[2],c=a.data[3];const l=o.x,d=o.y;h=l+(l-h),c=d+(d-c)}return this.instructions.push({action:"bezierCurveTo",data:[h,c,t,e,r,i,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){const i=this.instructions[this.instructions.length-1],n=this.getLastPoint(pt.shared);let a=0,o=0;if(!i||i.action!=="quadraticCurveTo")a=n.x,o=n.y;else{a=i.data[0],o=i.data[1];const h=n.x,c=n.y;a=h+(h-a),o=c+(c-o)}return this.instructions.push({action:"quadraticCurveTo",data:[a,o,t,e,r]}),this._dirty=!0,this}rect(t,e,r,i,n){return this.instructions.push({action:"rect",data:[t,e,r,i,n]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,i,n,a,o){n||(n=i/2);const h=-1*Math.PI/2+a,c=r*2,l=Math.PI*2/c,d=[];for(let f=0;f<c;f++){const u=f%2?n:i,g=f*l+h;d.push(t+u*Math.cos(g),e+u*Math.sin(g))}return this.poly(d,!0,o),this}clone(t=!1){const e=new bt;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let r=0;r<this.instructions.length;r++){const i=this.instructions[r];e.instructions.push({action:i.action,data:i.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,r=t.b,i=t.c,n=t.d,a=t.tx,o=t.ty;let h=0,c=0,l=0,d=0,f=0,u=0,g=0,p=0;for(let m=0;m<this.instructions.length;m++){const x=this.instructions[m],_=x.data;switch(x.action){case"moveTo":case"lineTo":h=_[0],c=_[1],_[0]=e*h+i*c+a,_[1]=r*h+n*c+o;break;case"bezierCurveTo":l=_[0],d=_[1],f=_[2],u=_[3],h=_[4],c=_[5],_[0]=e*l+i*d+a,_[1]=r*l+n*d+o,_[2]=e*f+i*u+a,_[3]=r*f+n*u+o,_[4]=e*h+i*c+a,_[5]=r*h+n*c+o;break;case"quadraticCurveTo":l=_[0],d=_[1],h=_[2],c=_[3],_[0]=e*l+i*d+a,_[1]=r*l+n*d+o,_[2]=e*h+i*c+a,_[3]=r*h+n*c+o;break;case"arcToSvg":h=_[5],c=_[6],g=_[0],p=_[1],_[0]=e*g+i*p,_[1]=r*g+n*p,_[5]=e*h+i*c+a,_[6]=r*h+n*c+o;break;case"circle":_[4]=Mt(_[3],t);break;case"rect":_[4]=Mt(_[4],t);break;case"ellipse":_[8]=Mt(_[8],t);break;case"roundRect":_[5]=Mt(_[5],t);break;case"addPath":_[0].transform(t);break;case"poly":_[2]=Mt(_[2],t);break;default:X("unknown transform action",x.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;r.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t);break}return t}}function Mt(s,t){return s?s.prepend(t):t.clone()}function Y(s,t,e){const r=s.getAttribute(t);return r?Number(r):e}function yn(s,t){const e=s.querySelectorAll("defs");for(let r=0;r<e.length;r++){const i=e[r];for(let n=0;n<i.children.length;n++){const a=i.children[n];switch(a.nodeName.toLowerCase()){case"lineargradient":t.defs[a.id]=bn(a);break;case"radialgradient":t.defs[a.id]=wn();break}}}}function bn(s){const t=Y(s,"x1",0),e=Y(s,"y1",0),r=Y(s,"x2",1),i=Y(s,"y2",0),n=s.getAttribute("gradientUnits")||"objectBoundingBox",a=new et(t,e,r,i,n==="objectBoundingBox"?"local":"global");for(let o=0;o<s.children.length;o++){const h=s.children[o],c=Y(h,"offset",0),l=z.shared.setValue(h.getAttribute("stop-color")).toNumber();a.addColorStop(c,l)}return a}function wn(s){return X("[SVG Parser] Radial gradients are not yet supported"),new et(0,0,1,0)}function lr(s){const t=s.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const cr={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function is(s,t){const e=s.getAttribute("style"),r={},i={},n={strokeStyle:r,fillStyle:i,useFill:!1,useStroke:!1};for(const a in cr){const o=s.getAttribute(a);o&&dr(t,n,a,o.trim())}if(e){const a=e.split(";");for(let o=0;o<a.length;o++){const h=a[o].trim(),[c,l]=h.split(":");cr[c]&&dr(t,n,c,l.trim())}}return{strokeStyle:n.useStroke?r:null,fillStyle:n.useFill?i:null,useFill:n.useFill,useStroke:n.useStroke}}function dr(s,t,e,r){switch(e){case"stroke":if(r!=="none"){if(r.startsWith("url(")){const i=lr(r);t.strokeStyle.fill=s.defs[i]}else t.strokeStyle.color=z.shared.setValue(r).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(r);break;case"fill":if(r!=="none"){if(r.startsWith("url(")){const i=lr(r);t.fillStyle.fill=s.defs[i]}else t.fillStyle.color=z.shared.setValue(r).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(r);break;case"stroke-opacity":t.strokeStyle.alpha=Number(r);break;case"opacity":t.fillStyle.alpha=Number(r),t.strokeStyle.alpha=Number(r);break}}function Tn(s,t){if(typeof s=="string"){const a=document.createElement("div");a.innerHTML=s.trim(),s=a.querySelector("svg")}const e={context:t,defs:{},path:new bt};yn(s,e);const r=s.children,{fillStyle:i,strokeStyle:n}=is(s,e);for(let a=0;a<r.length;a++){const o=r[a];o.nodeName.toLowerCase()!=="defs"&&ns(o,e,i,n)}return t}function ns(s,t,e,r){const i=s.children,{fillStyle:n,strokeStyle:a}=is(s,t);n&&e?e={...e,...n}:n&&(e=n),a&&r?r={...r,...a}:a&&(r=a);const o=!e&&!r;o&&(e={color:0});let h,c,l,d,f,u,g,p,m,x,_,T,w,S,b,y,A;switch(s.nodeName.toLowerCase()){case"path":S=s.getAttribute("d"),s.getAttribute("fill-rule")==="evenodd"&&X("SVG Evenodd fill rule not supported, your svg may render incorrectly"),b=new bt(S,!0),t.context.path(b),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"circle":g=Y(s,"cx",0),p=Y(s,"cy",0),m=Y(s,"r",0),t.context.ellipse(g,p,m,m),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"rect":h=Y(s,"x",0),c=Y(s,"y",0),y=Y(s,"width",0),A=Y(s,"height",0),x=Y(s,"rx",0),_=Y(s,"ry",0),x||_?t.context.roundRect(h,c,y,A,x||_):t.context.rect(h,c,y,A),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"ellipse":g=Y(s,"cx",0),p=Y(s,"cy",0),x=Y(s,"rx",0),_=Y(s,"ry",0),t.context.beginPath(),t.context.ellipse(g,p,x,_),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"line":l=Y(s,"x1",0),d=Y(s,"y1",0),f=Y(s,"x2",0),u=Y(s,"y2",0),t.context.beginPath(),t.context.moveTo(l,d),t.context.lineTo(f,u),r&&t.context.stroke(r);break;case"polygon":w=s.getAttribute("points"),T=w.match(/\d+/g).map(P=>parseInt(P,10)),t.context.poly(T,!0),e&&t.context.fill(e),r&&t.context.stroke(r);break;case"polyline":w=s.getAttribute("points"),T=w.match(/\d+/g).map(P=>parseInt(P,10)),t.context.poly(T,!1),r&&t.context.stroke(r);break;case"g":case"svg":break;default:{X(`[SVG parser] <${s.nodeName}> elements unsupported`);break}}o&&(e=null);for(let P=0;P<i.length;P++)ns(i[P],t,e,r)}function Sn(s){return z.isColorLike(s)}function ur(s){return s instanceof ae}function fr(s){return s instanceof et}function Cn(s){return s instanceof F}function Pn(s,t,e){const r=z.shared.setValue(t??0);return s.color=r.toNumber(),s.alpha=r.alpha===1?e.alpha:r.alpha,s.texture=F.WHITE,{...e,...s}}function Mn(s,t,e){return s.texture=t,{...e,...s}}function pr(s,t,e){return s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,{...e,...s}}function gr(s,t,e){return t.buildGradient(),s.fill=t,s.color=16777215,s.texture=t.texture,s.matrix=t.transform,s.textureSpace=t.textureSpace,{...e,...s}}function vn(s,t){const e={...t,...s},r=z.shared.setValue(e.color);return e.alpha*=r.alpha,e.color=r.toNumber(),e}function dt(s,t){if(s==null)return null;const e={},r=s;return Sn(s)?Pn(e,s,t):Cn(s)?Mn(e,s,t):ur(s)?pr(e,s,t):fr(s)?gr(e,s,t):r.fill&&ur(r.fill)?pr(r,r.fill,t):r.fill&&fr(r.fill)?gr(r,r.fill,t):vn(r,t)}function Qt(s,t){const{width:e,alignment:r,miterLimit:i,cap:n,join:a,pixelLine:o,...h}=t,c=dt(s,h);return c?{width:e,alignment:r,miterLimit:i,cap:n,join:a,pixelLine:o,...c}:null}const kn=new pt,mr=new B,Xe=class Q extends ne{constructor(){super(...arguments),this.uid=At("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new bt,this._transform=new B,this._fillStyle={...Q.defaultFillStyle},this._strokeStyle={...Q.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new K,this._boundsDirty=!0}clone(){const t=new Q;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=dt(t,Q.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=Qt(t,Q.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=dt(t,Q.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=dt(t,Q.defaultStrokeStyle),this}texture(t,e,r,i,n,a){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:n||t.frame.width,dh:a||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?z.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new bt,this}fill(t,e){let r;const i=this.instructions[this.instructions.length-1];return this._tick===0&&i&&i.action==="stroke"?r=i.data.path:r=this._activePath.clone(),r?(t!=null&&(e!==void 0&&typeof t=="number"&&(U(D,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=dt(t,Q.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(pt.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r&&r.action==="fill"?e=r.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=Qt(t,Q.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(r);else{e.data.hole=r;break}}return this._initNextPathLocation(),this}arc(t,e,r,i,n,a){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,r,i,n,a),this}arcTo(t,e,r,i,n){this._tick++;const a=this._transform;return this._activePath.arcTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*r+a.c*i+a.tx,a.b*r+a.d*i+a.ty,n),this}arcToSvg(t,e,r,i,n,a,o){this._tick++;const h=this._transform;return this._activePath.arcToSvg(t,e,r,i,n,h.a*a+h.c*o+h.tx,h.b*a+h.d*o+h.ty),this}bezierCurveTo(t,e,r,i,n,a,o){this._tick++;const h=this._transform;return this._activePath.bezierCurveTo(h.a*t+h.c*e+h.tx,h.b*t+h.d*e+h.ty,h.a*r+h.c*i+h.tx,h.b*r+h.d*i+h.ty,h.a*n+h.c*a+h.tx,h.b*n+h.d*a+h.ty,o),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform,i=this._activePath.instructions,n=r.a*t+r.c*e+r.tx,a=r.b*t+r.d*e+r.ty;return i.length===1&&i[0].action==="moveTo"?(i[0].data[0]=n,i[0].data[1]=a,this):(this._activePath.moveTo(n,a),this)}quadraticCurveTo(t,e,r,i,n){this._tick++;const a=this._transform;return this._activePath.quadraticCurveTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*r+a.c*i+a.tx,a.b*r+a.d*i+a.ty,n),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,n){return this._tick++,this._activePath.roundRect(t,e,r,i,n,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i,n=0,a){return this._tick++,this._activePath.regularPoly(t,e,r,i,n,a),this}roundPoly(t,e,r,i,n,a){return this._tick++,this._activePath.roundPoly(t,e,r,i,n,a),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,n){return this._tick++,this._activePath.filletRect(t,e,r,i,n),this}chamferRect(t,e,r,i,n,a){return this._tick++,this._activePath.chamferRect(t,e,r,i,n,a),this}star(t,e,r,i,n=0,a=0){return this._tick++,this._activePath.star(t,e,r,i,n,a,this._transform.clone()),this}svg(t){return this._tick++,Tn(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,i,n,a){return t instanceof B?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,i,n,a),this)}transform(t,e,r,i,n,a){return t instanceof B?(this._transform.append(t),this):(mr.set(t,e,r,i,n,a),this._transform.append(mr),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],i=r.action;if(i==="fill"){const n=r.data;t.addBounds(n.path.bounds)}else if(i==="texture"){const n=r.data;t.addFrame(n.dx,n.dy,n.dx+n.dw,n.dy+n.dh,n.transform)}if(i==="stroke"){const n=r.data,a=n.style.alignment,o=n.style.width*(1-a),h=n.path.bounds;t.addFrame(h.minX-o,h.minY-o,h.maxX+o,h.maxY+o)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let r=!1;for(let i=0;i<e.length;i++){const n=e[i],a=n.data,o=a.path;if(!n.action||!o)continue;const h=a.style,c=o.shapePath.shapePrimitives;for(let l=0;l<c.length;l++){const d=c[l].shape;if(!h||!d)continue;const f=c[l].transform,u=f?f.applyInverse(t,kn):t;if(n.action==="fill")r=d.contains(u.x,u.y);else{const p=h;r=d.strokeContains(u.x,u.y,p.width,p.alignment)}const g=a.hole;if(g){const p=g.shapePath?.shapePrimitives;if(p)for(let m=0;m<p.length;m++)p[m].shape.contains(u.x,u.y)&&(r=!1)}if(r)return!0}}return r}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(r),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(r)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Xe.defaultFillStyle={color:16777215,alpha:1,texture:F.WHITE,matrix:null,fill:null,textureSpace:"local"};Xe.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:F.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let j=Xe;const xr=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function Rn(s){const t=[];let e=0;for(let r=0;r<xr.length;r++){const i=`_${xr[r]}`;t[e++]=s[i]}return e=as(s._fill,t,e),e=Gn(s._stroke,t,e),e=An(s.dropShadow,t,e),e=Bn(s.filters,t,e),t.join("-")}function Bn(s,t,e){if(!s)return e;for(const r of s)t[e++]=r.uid;return e}function as(s,t,e){return s&&(t[e++]=s.color,t[e++]=s.alpha,t[e++]=s.fill?.styleKey),e}function Gn(s,t,e){return s&&(e=as(s,t,e),t[e++]=s.width,t[e++]=s.alignment,t[e++]=s.cap,t[e++]=s.join,t[e++]=s.miterLimit),e}function An(s,t,e){return s&&(t[e++]=s.alpha,t[e++]=s.angle,t[e++]=s.blur,t[e++]=s.distance,t[e++]=z.shared.setValue(s.color).toNumber()),e}const Ve=class _t extends ne{constructor(t={}){super(),Fn(t);const e={..._t.defaultTextStyle,...t};for(const r in e){const i=r;this[i]=e[r]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({..._t.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({..._t.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...j.defaultFillStyle,...t},()=>{this._fill=dt({...this._originalFill},j.defaultFillStyle)})),this._fill=dt(t===0?"black":t,j.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...j.defaultStrokeStyle,...t},()=>{this._stroke=Qt({...this._originalStroke},j.defaultStrokeStyle)})),this._stroke=Qt(t,j.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=Rn(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const t=_t.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new _t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(r),this._originalFill?.texture&&this._originalFill.texture.destroy(r),this._stroke?.texture&&this._stroke.texture.destroy(r),this._originalStroke?.texture&&this._originalStroke.texture.destroy(r)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(r,i,n)=>(r[i]=n,e?.(i,n),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(z.isColorLike(t)||t instanceof et||t instanceof ae)}};Ve.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};Ve.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Z=Ve;function Fn(s){const t=s;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=Z.defaultDropShadow;s.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){U(D,"strokeThickness is now a part of stroke");const e=t.stroke;let r={};if(z.isColorLike(e))r.color=e;else if(e instanceof et||e instanceof ae)r.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))r=e;else throw new Error("Invalid stroke value.");s.stroke={...r,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){U(D,"gradient fill is now a fill pattern: `new FillGradient(...)`");let e;s.fontSize==null?s.fontSize=Z.defaultTextStyle.fontSize:typeof s.fontSize=="string"?e=parseInt(s.fontSize,10):e=s.fontSize;const r=new et({start:{x:0,y:0},end:{x:0,y:(e||0)*1.7}}),i=t.fillGradientStops.map(n=>z.shared.setValue(n).toNumber());i.forEach((n,a)=>{const o=a/(i.length-1);r.addColorStop(o,n)}),s.fill={fill:r}}}const _r=1e5;function Jt(s,t,e,r=0){if(s.texture===F.WHITE&&!s.fill)return z.shared.setValue(s.color).setAlpha(s.alpha??1).toHexa();if(s.fill){if(s.fill instanceof ae){const i=s.fill,n=t.createPattern(i.texture.source.resource,"repeat"),a=i.transform.copyTo(B.shared);return a.scale(i.texture.frame.width,i.texture.frame.height),n.setTransform(a),n}else if(s.fill instanceof et){const i=s.fill,n=i.type==="linear",a=i.textureSpace==="local";let o=1,h=1;a&&e&&(o=e.width+r,h=e.height+r);let c,l=!1;if(n){const{start:d,end:f}=i;c=t.createLinearGradient(d.x*o,d.y*h,f.x*o,f.y*h),l=Math.abs(f.x-d.x)<Math.abs((f.y-d.y)*.1)}else{const{center:d,innerRadius:f,outerCenter:u,outerRadius:g}=i;c=t.createRadialGradient(d.x*o,d.y*h,f*o,u.x*o,u.y*h,g*o)}if(l&&a&&e){const d=e.lineHeight/h;for(let f=0;f<e.lines.length;f++){const u=(f*e.lineHeight+r/2)/h;i.colorStops.forEach(g=>{const p=u+g.offset*d;c.addColorStop(Math.floor(p*_r)/_r,z.shared.setValue(g.color).toHex())})}}else i.colorStops.forEach(d=>{c.addColorStop(d.offset,z.shared.setValue(d.color).toHex())});return c}}else{const i=t.createPattern(s.texture.source.resource,"repeat"),n=s.matrix.copyTo(B.shared);return n.scale(s.texture.frame.width,s.texture.frame.height),i.setTransform(n),i}return X("FillStyle not recognised",s),"red"}const os=class hs extends Zr{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...hs.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const r=e.style.clone();e.overrideFill&&(r._fill.color=16777215,r._fill.alpha=1,r._fill.texture=F.WHITE,r._fill.fill=null),this.applyFillAsTint=e.overrideFill;const i=r.fontSize;r.fontSize=this.baseMeasurementFontSize;const n=Kt(r);e.overrideSize?r._stroke&&(r._stroke.width*=this.baseRenderedFontSize/i):r.fontSize=this.baseRenderedFontSize=i,this._style=r,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof gt?e.textureStyle:new gt(e.textureStyle)),this.fontMetrics=q.measureFont(n),this.lineHeight=r.lineHeight||this.fontMetrics.fontSize||r.fontSize}ensureCharacters(t){const e=q.graphemeSegmenter(t).filter(m=>!this._currentChars.includes(m)).filter((m,x,_)=>_.indexOf(m)===x);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let r;this._currentPageIndex===-1?r=this._nextPage():r=this.pages[this._currentPageIndex];let{canvas:i,context:n}=r.canvasAndContext,a=r.texture.source;const o=this._style;let h=this._currentX,c=this._currentY,l=this._currentMaxCharHeight;const d=this.baseRenderedFontSize/this.baseMeasurementFontSize,f=this._padding*d;let u=!1;const g=i.width/this.resolution,p=i.height/this.resolution;for(let m=0;m<e.length;m++){const x=e[m],_=q.measureText(x,o,i,!1);_.lineHeight=_.height;const T=_.width*d,w=Math.ceil((o.fontStyle==="italic"?2:1)*T),S=_.height*d,b=w+f*2,y=S+f*2;if(u=!1,x!==`
`&&x!=="\r"&&x!=="	"&&x!==" "&&(u=!0,l=Math.ceil(Math.max(y,l))),h+b>g&&(c+=l,l=y,h=0,c+l>p)){a.update();const P=this._nextPage();i=P.canvasAndContext.canvas,n=P.canvasAndContext.context,a=P.texture.source,h=0,c=0,l=0}const A=T/d-(o.dropShadow?.distance??0)-(o._stroke?.width??0);if(this.chars[x]={id:x.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:A,kerning:{}},u){this._drawGlyph(n,_,h+f,c+f,d,o);const P=a.width*d,C=a.height*d,M=new it(h/P*a.width,c/C*a.height,b/P*a.width,y/C*a.height);this.chars[x].texture=new F({source:a,frame:M}),h+=Math.ceil(b)}}a.update(),this._currentX=h,this._currentY=c,this._currentMaxCharHeight=l,this._skipKerning&&this._applyKerning(e,n)}get pageTextures(){return U(D,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const r=this._measureCache;for(let i=0;i<t.length;i++){const n=t[i];for(let a=0;a<this._currentChars.length;a++){const o=this._currentChars[a];let h=r[n];h||(h=r[n]=e.measureText(n).width);let c=r[o];c||(c=r[o]=e.measureText(o).width);let l=e.measureText(n+o).width,d=l-(h+c);d&&(this.chars[n].kerning[o]=d),l=e.measureText(n+o).width,d=l-(h+c),d&&(this.chars[o].kerning[n]=d)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=yt.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new F({source:new Ce({resource:e.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(i.source.style=this._textureStyle);const n={canvasAndContext:e,texture:i};return this.pages[this._currentPageIndex]=n,n}_setupContext(t,e,r){e.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=Kt(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const i=e._stroke,n=i?.width??0;if(i&&(t.lineWidth=n,t.lineJoin=i.join,t.miterLimit=i.miterLimit,t.strokeStyle=Jt(i,t)),e._fill&&(t.fillStyle=Jt(e._fill,t)),e.dropShadow){const a=e.dropShadow,o=z.shared.setValue(a.color).toArray(),h=a.blur*r,c=a.distance*r;t.shadowColor=`rgba(${o[0]*255},${o[1]*255},${o[2]*255},${a.alpha})`,t.shadowBlur=h,t.shadowOffsetX=Math.cos(a.angle)*c,t.shadowOffsetY=Math.sin(a.angle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,r,i,n,a){const o=e.text,h=e.fontProperties,l=(a._stroke?.width??0)*n,d=r+l/2,f=i-l/2,u=h.descent*n,g=e.lineHeight*n;a.stroke&&l&&t.strokeText(o,d,f+g-u),a._fill&&t.fillText(o,d,f+g-u)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:r}=this.pages[t];yt.returnCanvasAndContext(e),r.destroy(!0)}this.pages=null}};os.defaultOptions={textureSize:512,style:new Z,mipmap:!0};let yr=os;function ls(s,t,e,r){const i={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};i.offsetY=e.baseLineOffset;let n=i.lines[0],a=null,o=!0;const h={width:0,start:0,index:0,positions:[],chars:[]},c=g=>{const p=n.width;for(let m=0;m<h.index;m++){const x=g.positions[m];n.chars.push(g.chars[m]),n.charPositions.push(x+p)}n.width+=g.width,o=!1,h.width=0,h.index=0,h.chars.length=0},l=()=>{let g=n.chars.length-1;if(r){let p=n.chars[g];for(;p===" ";)n.width-=e.chars[p].xAdvance,p=n.chars[--g]}i.width=Math.max(i.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,i.lines.push(n),i.height+=e.lineHeight},d=e.baseMeasurementFontSize/t.fontSize,f=t.letterSpacing*d,u=t.wordWrapWidth*d;for(let g=0;g<s.length+1;g++){let p;const m=g===s.length;m||(p=s[g]);const x=e.chars[p]||e.chars[" "];if(/(?:\s)/.test(p)||p==="\r"||p===`
`||m){if(!o&&t.wordWrap&&n.width+h.width-f>u?(l(),c(h),m||n.charPositions.push(0)):(h.start=n.width,c(h),m||n.charPositions.push(0)),p==="\r"||p===`
`)n.width!==0&&l();else if(!m){const S=x.xAdvance+(x.kerning[a]||0)+f;n.width+=S,n.spaceWidth=S,n.spacesIndex.push(n.charPositions.length),n.chars.push(p)}}else{const w=x.kerning[a]||0,S=x.xAdvance+w+f;h.positions[h.index++]=h.width+w,h.chars.push(p),h.width+=S}a=p}return l(),t.align==="center"?Un(i):t.align==="right"?Dn(i):t.align==="justify"&&In(i),i}function Un(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],r=s.width/2-e.width/2;for(let i=0;i<e.charPositions.length;i++)e.charPositions[i]+=r}}function Dn(s){for(let t=0;t<s.lines.length;t++){const e=s.lines[t],r=s.width-e.width;for(let i=0;i<e.charPositions.length;i++)e.charPositions[i]+=r}}function In(s){const t=s.width;for(let e=0;e<s.lines.length;e++){const r=s.lines[e];let i=0,n=r.spacesIndex[i++],a=0;const o=r.spacesIndex.length,c=(t-r.width)/o;for(let l=0;l<r.charPositions.length;l++)l===n&&(n=r.spacesIndex[i++],a+=c),r.charPositions[l]+=a}}function Ln(s){if(s==="")return[];typeof s=="string"&&(s=[s]);const t=[];for(let e=0,r=s.length;e<r;e++){const i=s[e];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(i[0].length===0||i[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const n=i[0].charCodeAt(0),a=i[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let o=n,h=a;o<=h;o++)t.push(String.fromCharCode(o))}else t.push(...Array.from(i))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let Et=0;class Wn{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null}}getFont(t,e){let r=`${e.fontFamily}-bitmap`,i=!0;if(e._fill.fill&&!e._stroke)r+=e._fill.fill.styleKey,i=!1;else if(e._stroke||e.dropShadow){let a=e.styleKey;a=a.substring(0,a.lastIndexOf("-")),r=`${a}-bitmap`,i=!1}if(!$.has(r)){const a=new yr({style:e,overrideFill:i,overrideSize:!0,...this.defaultOptions});Et++,Et>50&&X("BitmapText",`You have dynamically created ${Et} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),a.once("destroy",()=>{Et--,$.remove(r)}),$.set(r,a)}const n=$.get(r);return n.ensureCharacters?.(t),n}getLayout(t,e,r=!0){const i=this.getFont(t,e),n=q.graphemeSegmenter(t);return ls(n,e,i,r)}measureText(t,e,r=!0){return this.getLayout(t,e,r)}install(...t){let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},U(D,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const r=e?.name;if(!r)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const i=e.style,n=i instanceof Z?i:new Z(i),a=n._fill.fill!==null&&n._fill.fill!==void 0,o=new yr({style:n,overrideFill:a,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),h=Ln(e.chars);return o.ensureCharacters(h.join("")),$.set(`${r}-bitmap`,o),o.once("destroy",()=>$.remove(`${r}-bitmap`)),o}uninstall(t){const e=`${t}-bitmap`,r=$.get(e);r&&r.destroy()}}const Zt=new Wn;class cs extends Zr{constructor(t,e){super();const{textures:r,data:i}=t;Object.keys(i.pages).forEach(n=>{const a=i.pages[parseInt(n,10)],o=r[a.id];this.pages.push({texture:o})}),Object.keys(i.chars).forEach(n=>{const a=i.chars[n],{frame:o,source:h}=r[a.page],c=new it(a.x+o.x,a.y+o.y,a.width,a.height),l=new F({source:h,frame:c});this.chars[n]={id:n.codePointAt(0),xOffset:a.xOffset,yOffset:a.yOffset,xAdvance:a.xAdvance,kerning:a.kerning??{},texture:l}}),this.baseRenderedFontSize=i.fontSize,this.baseMeasurementFontSize=i.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},this.baseLineOffset=i.baseLineOffset,this.lineHeight=i.lineHeight,this.fontFamily=i.fontFamily,this.distanceField=i.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){Zt.install(t)}static uninstall(t){Zt.uninstall(t)}}const ye={test(s){return typeof s=="string"&&s.startsWith("info face=")},parse(s){const t=s.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const d in t){const f=t[d].match(/^[a-z]+/gm)[0],u=t[d].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),g={};for(const p in u){const m=u[p].split("="),x=m[0],_=m[1].replace(/"/gm,""),T=parseFloat(_),w=isNaN(T)?_:T;g[x]=w}e[f].push(g)}const r={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[i]=e.info,[n]=e.common,[a]=e.distanceField??[];a&&(r.distanceField={range:parseInt(a.distanceRange,10),type:a.fieldType}),r.fontSize=parseInt(i.size,10),r.fontFamily=i.face,r.lineHeight=parseInt(n.lineHeight,10);const o=e.page;for(let d=0;d<o.length;d++)r.pages.push({id:parseInt(o[d].id,10)||0,file:o[d].file});const h={};r.baseLineOffset=r.lineHeight-parseInt(n.base,10);const c=e.char;for(let d=0;d<c.length;d++){const f=c[d],u=parseInt(f.id,10);let g=f.letter??f.char??String.fromCharCode(u);g==="space"&&(g=" "),h[u]=g,r.chars[g]={id:u,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}const l=e.kerning||[];for(let d=0;d<l.length;d++){const f=parseInt(l[d].first,10),u=parseInt(l[d].second,10),g=parseInt(l[d].amount,10);r.chars[h[u]].kerning[h[f]]=g}return r}},br={test(s){const t=s;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(s){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=s.getElementsByTagName("info")[0],r=s.getElementsByTagName("common")[0],i=s.getElementsByTagName("distanceField")[0];i&&(t.distanceField={type:i.getAttribute("fieldType"),range:parseInt(i.getAttribute("distanceRange"),10)});const n=s.getElementsByTagName("page"),a=s.getElementsByTagName("char"),o=s.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(r.getAttribute("lineHeight"),10);for(let c=0;c<n.length;c++)t.pages.push({id:parseInt(n[c].getAttribute("id"),10)||0,file:n[c].getAttribute("file")});const h={};t.baseLineOffset=t.lineHeight-parseInt(r.getAttribute("base"),10);for(let c=0;c<a.length;c++){const l=a[c],d=parseInt(l.getAttribute("id"),10);let f=l.getAttribute("letter")??l.getAttribute("char")??String.fromCharCode(d);f==="space"&&(f=" "),h[d]=f,t.chars[f]={id:d,page:parseInt(l.getAttribute("page"),10)||0,x:parseInt(l.getAttribute("x"),10),y:parseInt(l.getAttribute("y"),10),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10),xOffset:parseInt(l.getAttribute("xoffset"),10),yOffset:parseInt(l.getAttribute("yoffset"),10),xAdvance:parseInt(l.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<o.length;c++){const l=parseInt(o[c].getAttribute("first"),10),d=parseInt(o[c].getAttribute("second"),10),f=parseInt(o[c].getAttribute("amount"),10);t.chars[h[d]].kerning[h[l]]=f}return t}},wr={test(s){return typeof s=="string"&&s.includes("<font>")?br.test(st.get().parseXML(s)):!1},parse(s){return br.parse(st.get().parseXML(s))}},zn=[".xml",".fnt"],Xa={extension:{type:k.CacheParser,name:"cacheBitmapFont"},test:s=>s instanceof cs,getCacheableAssets(s,t){const e={};return s.forEach(r=>{e[r]=t,e[`${r}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},Va={extension:{type:k.LoadParser,priority:Js.Normal},name:"loadBitmapFont",test(s){return zn.includes(ue.extname(s).toLowerCase())},async testParse(s){return ye.test(s)||wr.test(s)},async parse(s,t,e){const r=ye.test(s)?ye.parse(s):wr.parse(s),{src:i}=t,{pages:n}=r,a=[],o=r.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let d=0;d<n.length;++d){const f=n[d].file;let u=ue.join(ue.dirname(i),f);u=Zs(u,i),a.push({src:u,data:o})}const h=await e.load(a),c=a.map(d=>h[d.src]);return new cs({data:r,textures:c},i)},async load(s,t){return await(await st.get().fetch(s)).text()},async unload(s,t,e){await Promise.all(s.pages.map(r=>e.unload(r.texture.source._sourceOrigin))),s.destroy()}};function Oa(s,t){t.clear();const e=t.matrix;for(let r=0;r<s.length;r++){const i=s[r];i.globalDisplayStatus<7||(t.matrix=i.worldTransform,t.addBounds(i.bounds))}return t.matrix=e,t}class te extends Ut{constructor(t){t instanceof j&&(t={context:t});const{context:e,roundPixels:r,...i}=t||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new j,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=r??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new te(this._context.clone()):(this._ownedContext=null,new te(this._context))}lineStyle(t,e,r){U(D,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return t&&(i.width=t),e&&(i.color=e),r&&(i.alpha=r),this.context.strokeStyle=i,this}beginFill(t,e){U(D,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const r={};return t!==void 0&&(r.color=t),e!==void 0&&(r.alpha=e),this.context.fillStyle=r,this}endFill(){U(D,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==j.defaultStrokeStyle.width||t.color!==j.defaultStrokeStyle.color||t.alpha!==j.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return U(D,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return U(D,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return U(D,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return U(D,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return U(D,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return U(D,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}const ds=class us extends Er{constructor(...t){let e=t[0]??{};e instanceof Float32Array&&(U(D,"use new MeshGeometry({ positions, uvs, indices }) instead"),e={positions:e,uvs:t[1],indices:t[2]}),e={...us.defaultOptions,...e};const r=e.positions||new Float32Array([0,0,1,0,1,1,0,1]);let i=e.uvs;i||(e.positions?i=new Float32Array(r.length):i=new Float32Array([0,0,1,0,1,1,0,1]));const n=e.indices||new Uint32Array([0,1,2,0,2,3]),a=e.shrinkBuffersToFit,o=new vt({data:r,label:"attribute-mesh-positions",shrinkToFit:a,usage:J.VERTEX|J.COPY_DST}),h=new vt({data:i,label:"attribute-mesh-uvs",shrinkToFit:a,usage:J.VERTEX|J.COPY_DST}),c=new vt({data:n,label:"index-mesh-buffer",shrinkToFit:a,usage:J.INDEX|J.COPY_DST});super({attributes:{aPosition:{buffer:o,format:"float32x2",stride:2*4,offset:0},aUV:{buffer:h,format:"float32x2",stride:2*4,offset:0}},indexBuffer:c,topology:e.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};ds.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let Oe=ds;class Be extends qt{constructor(...t){let e=t[0];Array.isArray(t[0])&&(e={textures:t[0],autoUpdate:t[1]});const{animationSpeed:r=1,autoPlay:i=!1,autoUpdate:n=!0,loop:a=!0,onComplete:o=null,onFrameChange:h=null,onLoop:c=null,textures:l,updateAnchor:d=!1,...f}=e,[u]=l;super({...f,texture:u instanceof F?u:u.texture}),this._textures=null,this._durations=null,this._autoUpdate=n,this._isConnectedToTicker=!1,this.animationSpeed=r,this.loop=a,this.updateAnchor=d,this.onComplete=o,this.onFrameChange=h,this.onLoop=c,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=l,i&&this.play()}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Wt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Wt.shared.add(this.update,this,ti.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=t.deltaTime,r=this.animationSpeed*e,i=this.currentFrame;if(this._durations!==null){let n=this._currentTime%1*this._durations[this.currentFrame];for(n+=r/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];const a=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this._updateTexture())}_updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this.texture=this._textures[t],this.updateAnchor&&this.texture.defaultAnchor&&this.anchor.copyFrom(this.texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let r=0;r<t.length;++r)e.push(F.from(t[r]));return new Be(e)}static fromImages(t){const e=[];for(let r=0;r<t.length;++r)e.push(F.from(t[r]));return new Be(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof F)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Wt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Wt.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const fs=class Ot extends Ut{constructor(...t){let e=t[0]||{};e instanceof F&&(e={texture:e}),t.length>1&&(U(D,"use new TilingSprite({ texture, width:100, height:100 }) instead"),e.width=t[1],e.height=t[2]),e={...Ot.defaultOptions,...e};const{texture:r,anchor:i,tilePosition:n,tileScale:a,tileRotation:o,width:h,height:c,applyAnchorToTexture:l,roundPixels:d,...f}=e??{};super({label:"TilingSprite",...f}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new O({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=l,this.texture=r,this._width=h??r.width,this._height=c??r.height,this._tileTransform=new ei({observer:{_onUpdate:()=>this.onViewUpdate()}}),i&&(this.anchor=i),this.tilePosition=n,this.tileScale=a,this.tileRotation=o,this.roundPixels=d??!1}static from(t,e={}){return typeof t=="string"?new Ot({texture:$.get(t),...e}):new Ot({texture:t,...e})}get uvRespectAnchor(){return X("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(t){X("uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=t}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(t){this._texture.textureMatrix.clampMargin=t}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get tilePosition(){return this._tileTransform.position}set tilePosition(t){this._tileTransform.position.copyFrom(t)}get tileScale(){return this._tileTransform.scale}set tileScale(t){typeof t=="number"?this._tileTransform.scale.set(t):this._tileTransform.scale.copyFrom(t)}set tileRotation(t){this._tileTransform.rotation=t}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(t){t||(t=F.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get texture(){return this._texture}set width(t){this._width=t,this.onViewUpdate()}get width(){return this._width}set height(t){this._height=t,this.onViewUpdate()}get height(){return this._height}setSize(t,e){typeof t=="object"&&(e=t.height??t.width,t=t.width),this._width=t,this._height=e??t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}updateBounds(){const t=this._bounds,e=this._anchor,r=this._width,i=this._height;t.minX=-e._x*r,t.maxX=t.minX+r,t.minY=-e._y*i,t.maxY=t.minY+i}containsPoint(t){const e=this._width,r=this._height,i=-e*this._anchor._x;let n=0;return t.x>=i&&t.x<=i+e&&(n=-r*this._anchor._y,t.y>=n&&t.y<=n+r)}destroy(t=!1){if(super.destroy(t),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(r)}this._texture=null}};fs.defaultOptions={texture:F.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let Ha=fs;class ps extends Ut{constructor(t,e){const{text:r,resolution:i,style:n,anchor:a,width:o,height:h,roundPixels:c,...l}=t;super({...l}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=r??"",this.style=n,this.resolution=i??null,this.allowChildren=!1,this._anchor=new O({_onUpdate:()=>{this.onViewUpdate()}}),a&&(this.anchor=a),this.roundPixels=c??!1,o!==void 0&&(this.width=o),h!==void 0&&(this.height=h)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){t||(t={}),this._style?.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,r=this.bounds.height,i=-e*this.anchor.x;let n=0;return t.x>=i&&t.x<=i+e&&(n=-r*this.anchor.y,t.y>=n&&t.y<=n+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t?.style)&&this._style.destroy(t),this._style=null,this._text=null}}function gs(s,t){let e=s[0]??{};return(typeof e=="string"||s[1])&&(U(D,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:s[1]}),e}const Tr=new it;class Yn{getCanvasAndContext(t){const{text:e,style:r,resolution:i=1}=t,n=r._getFinalPadding(),a=q.measureText(e||" ",r),o=Math.ceil(Math.ceil(Math.max(1,a.width)+n*2)*i),h=Math.ceil(Math.ceil(Math.max(1,a.height)+n*2)*i),c=yt.getOptimalCanvasAndContext(o,h);this._renderTextToCanvas(e,r,n,i,c);const l=r.trim?ri({canvas:c.canvas,width:o,height:h,resolution:1,output:Tr}):Tr.set(0,0,o,h);return{canvasAndContext:c,frame:l}}returnCanvasAndContext(t){yt.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,r,i,n){const{canvas:a,context:o}=n,h=Kt(e),c=q.measureText(t||" ",e),l=c.lines,d=c.lineHeight,f=c.lineWidths,u=c.maxLineWidth,g=c.fontProperties,p=a.height;if(o.resetTransform(),o.scale(i,i),o.textBaseline=e.textBaseline,e._stroke?.width){const T=e._stroke;o.lineWidth=T.width,o.miterLimit=T.miterLimit,o.lineJoin=T.join,o.lineCap=T.cap}o.font=h;let m,x;const _=e.dropShadow?2:1;for(let T=0;T<_;++T){const w=e.dropShadow&&T===0,S=w?Math.ceil(Math.max(1,p)+r*2):0,b=S*i;if(w){o.fillStyle="black",o.strokeStyle="black";const P=e.dropShadow,C=P.color,M=P.alpha;o.shadowColor=z.shared.setValue(C).setAlpha(M).toRgbaString();const W=P.blur*i,I=P.distance*i;o.shadowBlur=W,o.shadowOffsetX=Math.cos(P.angle)*I,o.shadowOffsetY=Math.sin(P.angle)*I+b}else{if(o.fillStyle=e._fill?Jt(e._fill,o,c):null,e._stroke?.width){const P=e._stroke.width*e._stroke.alignment;o.strokeStyle=Jt(e._stroke,o,c,P)}o.shadowColor="black"}let y=(d-g.fontSize)/2;d-g.fontSize<0&&(y=0);const A=e._stroke?.width??0;for(let P=0;P<l.length;P++)m=A/2,x=A/2+P*d+g.ascent+y,e.align==="right"?m+=u-f[P]:e.align==="center"&&(m+=(u-f[P])/2),e._stroke?.width&&this._drawLetterSpacing(l[P],e,n,m+r,x+r-S,!0),e._fill!==void 0&&this._drawLetterSpacing(l[P],e,n,m+r,x+r-S)}}_drawLetterSpacing(t,e,r,i,n,a=!1){const{context:o}=r,h=e.letterSpacing;let c=!1;if(q.experimentalLetterSpacingSupported&&(q.experimentalLetterSpacing?(o.letterSpacing=`${h}px`,o.textLetterSpacing=`${h}px`,c=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),h===0||c){a?o.strokeText(t,i,n):o.fillText(t,i,n);return}let l=i;const d=q.graphemeSegmenter(t);let f=o.measureText(t).width,u=0;for(let g=0;g<d.length;++g){const p=d[g];a?o.strokeText(p,l,n):o.fillText(p,l,n);let m="";for(let x=g+1;x<d.length;++x)m+=d[x];u=o.measureText(m).width,l+=f-u+h,f=u}}}const Bt=new Yn;class Na extends ps{constructor(...t){const e=gs(t,"Text");super(e,Z),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof gt?e.textureStyle:new gt(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let r=0,i=0;if(this._style.trim){const{frame:n,canvasAndContext:a}=Bt.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Bt.returnCanvasAndContext(a),r=n.width,i=n.height}else{const n=q.measureText(this._text,this._style);r=n.width,i=n.height}t.minX=-e._x*r,t.maxX=t.minX+r,t.minY=-e._y*i,t.maxY=t.minY+i}}class $a extends ps{constructor(...t){var e;const r=gs(t,"BitmapText");r.style??(r.style=r.style||{}),(e=r.style).fill??(e.fill=16777215),super(r,Z),this.renderPipeId="bitmapText"}updateBounds(){const t=this._bounds,e=this._anchor,r=Zt.measureText(this.text,this._style),i=r.scale,n=r.offsetY*i;let a=r.width*i,o=r.height*i;const h=this._style._stroke;h&&(a+=h.width,o+=h.width),t.minX=-e._x*a,t.maxX=t.minX+a,t.minY=-e._y*(o+n),t.maxY=t.minY+o}set resolution(t){t!==null&&X("[BitmapText] dynamically updating the resolution is not supported. Resolution should be managed by the BitmapFont.")}get resolution(){return this._resolution}}function En(s){const t=s._stroke,e=s._fill,i=[`div { ${[`color: ${z.shared.setValue(e.color).toHex()}`,`font-size: ${s.fontSize}px`,`font-family: ${s.fontFamily}`,`font-weight: ${s.fontWeight}`,`font-style: ${s.fontStyle}`,`font-variant: ${s.fontVariant}`,`letter-spacing: ${s.letterSpacing}px`,`text-align: ${s.align}`,`padding: ${s.padding}px`,`white-space: ${s.whiteSpace==="pre"&&s.wordWrap?"pre-wrap":s.whiteSpace}`,...s.lineHeight?[`line-height: ${s.lineHeight}px`]:[],...s.wordWrap?[`word-wrap: ${s.breakWords?"break-all":"break-word"}`,`max-width: ${s.wordWrapWidth}px`]:[],...t?[xs(t)]:[],...s.dropShadow?[ms(s.dropShadow)]:[],...s.cssOverrides].join(";")} }`];return Xn(s.tagStyles,i),i.join(" ")}function ms(s){const t=z.shared.setValue(s.color).setAlpha(s.alpha).toHexa(),e=Math.round(Math.cos(s.angle)*s.distance),r=Math.round(Math.sin(s.angle)*s.distance),i=`${e}px ${r}px`;return s.blur>0?`text-shadow: ${i} ${s.blur}px ${t}`:`text-shadow: ${i} ${t}`}function xs(s){return[`-webkit-text-stroke-width: ${s.width}px`,`-webkit-text-stroke-color: ${z.shared.setValue(s.color).toHex()}`,`text-stroke-width: ${s.width}px`,`text-stroke-color: ${z.shared.setValue(s.color).toHex()}`,"paint-order: stroke"].join(";")}const Sr={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},Cr={fill:s=>`color: ${z.shared.setValue(s).toHex()}`,breakWords:s=>`word-wrap: ${s?"break-all":"break-word"}`,stroke:xs,dropShadow:ms};function Xn(s,t){for(const e in s){const r=s[e],i=[];for(const n in r)Cr[n]?i.push(Cr[n](r[n])):Sr[n]&&i.push(Sr[n].replace("{{VALUE}}",r[n]));t.push(`${e} { ${i.join(";")} }`)}}class He extends Z{constructor(t={}){super(t),this._cssOverrides=[],this.cssOverrides=t.cssOverrides??[],this.tagStyles=t.tagStyles??{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}update(){this._cssStyle=null,super.update()}clone(){return new He({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides,tagStyles:{...this.tagStyles}})}get cssStyle(){return this._cssStyle||(this._cssStyle=En(this)),this._cssStyle}addOverride(...t){const e=t.filter(r=>!this.cssOverrides.includes(r));e.length>0&&(this.cssOverrides.push(...e),this.update())}removeOverride(...t){const e=t.filter(r=>this.cssOverrides.includes(r));e.length>0&&(this.cssOverrides=this.cssOverrides.filter(r=>!e.includes(r)),this.update())}set fill(t){typeof t!="string"&&typeof t!="number"&&X("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=t}set stroke(t){t&&typeof t!="string"&&typeof t!="number"&&X("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=t}}const Pr="http://www.w3.org/2000/svg",Mr="http://www.w3.org/1999/xhtml";class _s{constructor(){this.svgRoot=document.createElementNS(Pr,"svg"),this.foreignObject=document.createElementNS(Pr,"foreignObject"),this.domElement=document.createElementNS(Mr,"div"),this.styleElement=document.createElementNS(Mr,"style"),this.image=new Image;const{foreignObject:t,svgRoot:e,styleElement:r,domElement:i}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(r),t.appendChild(i)}}let vr;function Vn(s,t,e,r){r||(r=vr||(vr=new _s));const{domElement:i,styleElement:n,svgRoot:a}=r;i.innerHTML=`<style>${t.cssStyle};</style><div style='padding:0'>${s}</div>`,i.setAttribute("style","transform-origin: top left; display: inline-block"),e&&(n.textContent=e),document.body.appendChild(a);const o=i.getBoundingClientRect();a.remove();const h=t.padding*2;return{width:o.width-h,height:o.height-h}}class On{contextChange(t){const e=new mt({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new B,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),r=t.limits.maxBatchableTextures,i=ee({name:"graphics",bits:[Xr,Vr(r),Ue,re]});this.shader=new xt({glProgram:i,resources:{localUniforms:e,batchSamplers:Or(r)}})}execute(t,e){const r=e.context,i=r.customShader||this.shader,n=t.renderer,a=n.graphicsContext,{batcher:o,instructions:h}=a.getContextRenderData(r);i.groups[0]=n.globalUniforms.bindGroup,n.state.set(t.state),n.shader.bind(i),n.geometry.bind(o.geometry,i.glProgram);const c=h.instructions;for(let l=0;l<h.instructionSize;l++){const d=c[l];if(d.size){for(let f=0;f<d.textures.count;f++)n.texture.bind(d.textures.textures[f],f);n.geometry.draw(d.topology,d.size,d.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}On.extension={type:[k.WebGLPipesAdaptor],name:"graphics"};class Hn{init(){const t=ee({name:"mesh",bits:[Ue,oi,re]});this._shader=new xt({glProgram:t,resources:{uTexture:F.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new B}}}})}execute(t,e){const r=t.renderer;let i=e._shader;if(i){if(!i.glProgram){X("Mesh shader has no glProgram",e.shader);return}}else{i=this._shader;const n=e.texture,a=n.source;i.resources.uTexture=a,i.resources.uSampler=a.style,i.resources.textureUniforms.uniforms.uTextureMatrix=n.textureMatrix.mapCoord}i.groups[100]=r.globalUniforms.bindGroup,i.groups[101]=t.localUniformsBindGroup,r.encoder.draw({geometry:e._geometry,shader:i,state:e.state})}destroy(){this._shader.destroy(!0),this._shader=null}}Hn.extension={type:[k.WebGLPipesAdaptor],name:"mesh"};class Nn{constructor(t){this._renderer=t}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(t,e){this._renderer.renderPipes.batch.break(e),e.add(t)}execute(t){t.isRenderable&&t.render(this._renderer)}destroy(){this._renderer=null}}Nn.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"customRender"};class he{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}destroy(){}}function Ge(s,t){const e=s.instructionSet,r=e.instructions;for(let i=0;i<e.instructionSize;i++){const n=r[i];t[n.renderPipeId].execute(n)}}const $n=new B;class jn{constructor(t){this._renderer=t}addRenderGroup(t,e){t.isCachedAsTexture?this._addRenderableCacheAsTexture(t,e):this._addRenderableDirect(t,e)}execute(t){t.isRenderable&&(t.isCachedAsTexture?this._executeCacheAsTexture(t):this._executeDirect(t))}destroy(){this._renderer=null}_addRenderableDirect(t,e){this._renderer.renderPipes.batch.break(e),t._batchableRenderGroup&&(N.return(t._batchableRenderGroup),t._batchableRenderGroup=null),e.add(t)}_addRenderableCacheAsTexture(t,e){const r=t._batchableRenderGroup??(t._batchableRenderGroup=N.get(he));r.renderable=t.root,r.transform=t.root.relativeGroupTransform,r.texture=t.texture,r.bounds=t._textureBounds,e.add(t),this._renderer.renderPipes.batch.addToBatch(r,e)}_executeCacheAsTexture(t){if(t.textureNeedsUpdate){t.textureNeedsUpdate=!1;const e=$n.identity().translate(-t._textureBounds.x,-t._textureBounds.y);this._renderer.renderTarget.push(t.texture,!0,null,t.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:e,worldColor:4294967295}),Ge(t,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}t._batchableRenderGroup._batcher.updateElement(t._batchableRenderGroup),t._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(t){this._renderer.globalUniforms.push({worldTransformMatrix:t.inverseParentTextureTransform,worldColor:t.worldColorAlpha}),Ge(t,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}}jn.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"renderGroup"};function Ae(s,t){t||(t=0);for(let e=t;e<s.length&&s[e];e++)s[e]=null}const qn=new Ft,kr=kt|jt|Le;function ys(s,t=!1){Kn(s);const e=s.childrenToUpdate,r=s.updateTick++;for(const i in e){const n=Number(i),a=e[i],o=a.list,h=a.index;for(let c=0;c<h;c++){const l=o[c];l.parentRenderGroup===s&&l.relativeRenderGroupDepth===n&&bs(l,r,0)}Ae(o,h),a.index=0}if(t)for(let i=0;i<s.renderGroupChildren.length;i++)ys(s.renderGroupChildren[i],t)}function Kn(s){const t=s.root;let e;if(s.renderGroupParent){const r=s.renderGroupParent;s.worldTransform.appendFrom(t.relativeGroupTransform,r.worldTransform),s.worldColor=$t(t.groupColor,r.worldColor),e=t.groupAlpha*r.worldAlpha}else s.worldTransform.copyFrom(t.localTransform),s.worldColor=t.localColor,e=t.localAlpha;e=e<0?0:e>1?1:e,s.worldAlpha=e,s.worldColorAlpha=s.worldColor+((e*255|0)<<24)}function bs(s,t,e){if(t===s.updateTick)return;s.updateTick=t,s.didChange=!1;const r=s.localTransform;s.updateLocalTransform();const i=s.parent;if(i&&!i.renderGroup?(e|=s._updateFlags,s.relativeGroupTransform.appendFrom(r,i.relativeGroupTransform),e&kr&&Rr(s,i,e)):(e=s._updateFlags,s.relativeGroupTransform.copyFrom(r),e&kr&&Rr(s,qn,e)),!s.renderGroup){const n=s.children,a=n.length;for(let c=0;c<a;c++)bs(n[c],t,e);const o=s.parentRenderGroup,h=s;h.renderPipeId&&!o.structureDidChange&&o.updateRenderable(h)}}function Rr(s,t,e){if(e&jt){s.groupColor=$t(s.localColor,t.groupColor);let r=s.localAlpha*t.groupAlpha;r=r<0?0:r>1?1:r,s.groupAlpha=r,s.groupColorAlpha=s.groupColor+((r*255|0)<<24)}e&Le&&(s.groupBlendMode=s.localBlendMode==="inherit"?t.groupBlendMode:s.localBlendMode),e&kt&&(s.globalDisplayStatus=s.localDisplayStatus&t.globalDisplayStatus),s._updateFlags=0}function Qn(s,t){const{list:e,index:r}=s.childrenRenderablesToUpdate;let i=!1;for(let n=0;n<r;n++){const a=e[n];if(i=t[a.renderPipeId].validateRenderable(a),i)break}return s.structureDidChange=i,i}const Jn=new B;class Zn{constructor(t){this._renderer=t}render({container:t,transform:e}){const r=t.parent,i=t.renderGroup.renderGroupParent;t.parent=null,t.renderGroup.renderGroupParent=null;const n=this._renderer;let a=Jn;e&&(a=a.copyFrom(t.renderGroup.localTransform),t.renderGroup.localTransform.copyFrom(e));const o=n.renderPipes;this._updateCachedRenderGroups(t.renderGroup,null),this._updateRenderGroups(t.renderGroup),n.globalUniforms.start({worldTransformMatrix:e?t.renderGroup.localTransform:t.renderGroup.worldTransform,worldColor:t.renderGroup.worldColorAlpha}),Ge(t.renderGroup,o),o.uniformBatch&&o.uniformBatch.renderEnd(),e&&t.renderGroup.localTransform.copyFrom(a),t.parent=r,t.renderGroup.renderGroupParent=i}destroy(){this._renderer=null}_updateCachedRenderGroups(t,e){if(t.isCachedAsTexture){if(!t.updateCacheTexture)return;e=t}t._parentCacheAsTextureRenderGroup=e;for(let r=t.renderGroupChildren.length-1;r>=0;r--)this._updateCachedRenderGroups(t.renderGroupChildren[r],e);if(t.invalidateMatrices(),t.isCachedAsTexture){if(t.textureNeedsUpdate){const r=t.root.getLocalBounds();r.ceil();const i=t.texture;t.texture&&ut.returnTexture(t.texture);const n=this._renderer,a=t.textureOptions.resolution||n.view.resolution,o=t.textureOptions.antialias??n.view.antialias;t.texture=ut.getOptimalTexture(r.width,r.height,a,o),t._textureBounds||(t._textureBounds=new K),t._textureBounds.copyFrom(r),i!==t.texture&&t.renderGroupParent&&(t.renderGroupParent.structureDidChange=!0)}}else t.texture&&(ut.returnTexture(t.texture),t.texture=null)}_updateRenderGroups(t){const e=this._renderer,r=e.renderPipes;if(t.runOnRender(e),t.instructionSet.renderPipes=r,t.structureDidChange?Ae(t.childrenRenderablesToUpdate.list,0):Qn(t,r),ys(t),t.structureDidChange?(t.structureDidChange=!1,this._buildInstructions(t,e)):this._updateRenderables(t),t.childrenRenderablesToUpdate.index=0,e.renderPipes.batch.upload(t.instructionSet),!(t.isCachedAsTexture&&!t.textureNeedsUpdate))for(let i=0;i<t.renderGroupChildren.length;i++)this._updateRenderGroups(t.renderGroupChildren[i])}_updateRenderables(t){const{list:e,index:r}=t.childrenRenderablesToUpdate;for(let i=0;i<r;i++){const n=e[i];n.didViewUpdate&&t.updateRenderable(n)}Ae(e,r)}_buildInstructions(t,e){const r=t.root,i=t.instructionSet;i.reset();const n=e.renderPipes?e:e.batch.renderer,a=n.renderPipes;a.batch.buildStart(i),a.blendMode.buildStart(),a.colorMask.buildStart(),r.sortableChildren&&r.sortChildren(),r.collectRenderablesWithEffects(i,n,null),a.batch.buildEnd(i),a.blendMode.buildEnd(i)}}Zn.extension={type:[k.WebGLSystem,k.WebGPUSystem,k.CanvasSystem],name:"renderGroup"};class ta{constructor(t){this._renderer=t}addRenderable(t,e){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}_updateBatchableSprite(t,e){e.bounds=t.visualBounds,e.texture=t._texture}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=new he;return e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.bounds=t.visualBounds,e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}ta.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"sprite"};function le(s,t,e){const r=(s>>24&255)/255;t[e++]=(s&255)/255*r,t[e++]=(s>>8&255)/255*r,t[e++]=(s>>16&255)/255*r,t[e++]=r}class ea{constructor(){this._maxTextures=0}contextChange(t){const e=new mt({uTransformMatrix:{value:new B,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}});this._maxTextures=t.limits.maxBatchableTextures;const r=se({name:"graphics",bits:[Hr,Nr(this._maxTextures),hi,ie]});this.shader=new xt({gpuProgram:r,resources:{localUniforms:e}})}execute(t,e){const r=e.context,i=r.customShader||this.shader,n=t.renderer,a=n.graphicsContext,{batcher:o,instructions:h}=a.getContextRenderData(r),c=n.encoder;c.setGeometry(o.geometry,i.gpuProgram);const l=n.globalUniforms.bindGroup;c.setBindGroup(0,l,i.gpuProgram);const d=n.renderPipes.uniformBatch.getUniformBindGroup(i.resources.localUniforms,!0);c.setBindGroup(2,d,i.gpuProgram);const f=h.instructions;let u=null;for(let g=0;g<h.instructionSize;g++){const p=f[g];if(p.topology!==u&&(u=p.topology,c.setPipelineFromGeometryProgramAndState(o.geometry,i.gpuProgram,t.state,p.topology)),i.groups[1]=p.bindGroup,!p.gpuBindGroup){const m=p.textures;p.bindGroup=Yr(m.textures,m.count,this._maxTextures),p.gpuBindGroup=n.bindGroup.getBindGroup(p.bindGroup,i.gpuProgram,1)}c.setBindGroup(1,p.bindGroup,i.gpuProgram),c.renderPassEncoder.drawIndexed(p.size,1,p.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}ea.extension={type:[k.WebGPUPipesAdaptor],name:"graphics"};class ra{init(){const t=se({name:"mesh",bits:[$r,li,ie]});this._shader=new xt({gpuProgram:t,resources:{uTexture:F.EMPTY._source,uSampler:F.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new B}}}})}execute(t,e){const r=t.renderer;let i=e._shader;if(!i)i=this._shader,i.groups[2]=r.texture.getTextureBindGroup(e.texture);else if(!i.gpuProgram){X("Mesh shader has no gpuProgram",e.shader);return}const n=i.gpuProgram;if(n.autoAssignGlobalUniforms&&(i.groups[0]=r.globalUniforms.bindGroup),n.autoAssignLocalUniforms){const a=t.localUniforms;i.groups[1]=r.renderPipes.uniformBatch.getUniformBindGroup(a,!0)}r.encoder.draw({geometry:e._geometry,shader:i,state:e.state})}destroy(){this._shader.destroy(!0),this._shader=null}}ra.extension={type:[k.WebGPUPipesAdaptor],name:"mesh"};class sa{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{N.return(t)}),this.batches.length=0}}class ws{constructor(t,e){this.state=Nt.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this)}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const e=t.context,r=!!t._gpuData,i=this.renderer.graphicsContext.updateGpuContext(e);return!!(i.isBatchable||r!==i.isBatchable)}addRenderable(t,e){const r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const r=this._getGpuDataForRenderable(t).batches;for(let i=0;i<r.length;i++){const n=r[i];n._batcher.updateElement(n)}}execute(t){if(!t.isRenderable)return;const e=this.renderer,r=t.context;if(!e.graphicsContext.getGpuContext(r).batches.length)return;const n=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const a=n.resources.localUniforms.uniforms;a.uTransformMatrix=t.groupTransform,a.uRound=e._roundPixels|t._roundPixels,le(t.groupColorAlpha,a.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=this._getGpuDataForRenderable(t),r=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),r.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){const r=this.renderer.renderPipes.batch,i=this._getGpuDataForRenderable(t).batches;for(let n=0;n<i.length;n++){const a=i[n];r.addToBatch(a,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const e=new sa;return t._gpuData[this.renderer.uid]=e,e}_updateBatchesForRenderable(t,e){const r=t.context,i=this.renderer.graphicsContext.getGpuContext(r),n=this.renderer._roundPixels|t._roundPixels;e.batches=i.batches.map(a=>{const o=N.get(ze);return a.copyTo(o),o.renderable=t,o.roundPixels=n,o})}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}ws.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"graphics"};const Ts=class Ss extends Oe{constructor(...t){super({});let e=t[0]??{};typeof e=="number"&&(U(D,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),e={width:e,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(e)}build(t){t={...Ss.defaultOptions,...t},this.verticesX=this.verticesX??t.verticesX,this.verticesY=this.verticesY??t.verticesY,this.width=this.width??t.width,this.height=this.height??t.height;const e=this.verticesX*this.verticesY,r=[],i=[],n=[],a=this.verticesX-1,o=this.verticesY-1,h=this.width/a,c=this.height/o;for(let d=0;d<e;d++){const f=d%this.verticesX,u=d/this.verticesX|0;r.push(f*h,u*c),i.push(f/a,u/o)}const l=a*o;for(let d=0;d<l;d++){const f=d%a,u=d/a|0,g=u*this.verticesX+f,p=u*this.verticesX+f+1,m=(u+1)*this.verticesX+f,x=(u+1)*this.verticesX+f+1;n.push(g,p,m,p,x,m)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint32Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};Ts.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let ia=Ts;class Ne{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const e=this.geometry.getBuffer("aUV"),r=e.data;let i=r;const n=this.texture.textureMatrix;return n.isSimple||(i=this._transformedUvs,(this._textureMatrixUpdateId!==n._updateID||this._uvUpdateId!==e._updateID)&&((!i||i.length<r.length)&&(i=this._transformedUvs=new Float32Array(r.length)),this._textureMatrixUpdateId=n._updateID,this._uvUpdateId=e._updateID,n.multiplyUvs(r,i))),i}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class Br{destroy(){}}class Cs{constructor(t,e){this.localUniforms=new mt({uTransformMatrix:{value:new B,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new ci({0:this.localUniforms}),this.renderer=t,this._adaptor=e,this._adaptor.init()}validateRenderable(t){const e=this._getMeshData(t),r=e.batched,i=t.batched;if(e.batched=i,r!==i)return!0;if(i){const n=t._geometry;if(n.indices.length!==e.indexSize||n.positions.length!==e.vertexSize)return e.indexSize=n.indices.length,e.vertexSize=n.positions.length,!0;const a=this._getBatchableMesh(t);return a.texture.uid!==t._texture.uid&&(a._textureMatrixUpdateId=-1),!a._batcher.checkAndUpdateTexture(a,t._texture)}return!1}addRenderable(t,e){const r=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(t);if(i){const n=this._getBatchableMesh(t);n.setTexture(t._texture),n.geometry=t._geometry,r.addToBatch(n,e)}else r.break(e),e.add(t)}updateRenderable(t){if(t.batched){const e=this._getBatchableMesh(t);e.setTexture(t._texture),e.geometry=t._geometry,e._batcher.updateElement(e)}}execute(t){if(!t.isRenderable)return;t.state.blendMode=De(t.groupBlendMode,t.texture._source);const e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),le(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){var e,r;return(e=t._gpuData)[r=this.renderer.uid]||(e[r]=new Br),t._gpuData[this.renderer.uid].meshData||this._initMeshData(t)}_initMeshData(t){return t._gpuData[this.renderer.uid].meshData={batched:t.batched,indexSize:t._geometry.indices?.length,vertexSize:t._geometry.positions?.length},t._gpuData[this.renderer.uid].meshData}_getBatchableMesh(t){var e,r;return(e=t._gpuData)[r=this.renderer.uid]||(e[r]=new Br),t._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(t)}_initBatchableMesh(t){const e=new Ne;return e.renderable=t,e.setTexture(t._texture),e.transform=t.groupTransform,e.roundPixels=this.renderer._roundPixels|t._roundPixels,t._gpuData[this.renderer.uid].batchableMesh=e,e}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}Cs.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"mesh"};class na{execute(t,e){const r=t.state,i=t.renderer,n=e.shader||t.defaultShader;n.resources.uTexture=e.texture._source,n.resources.uniforms=t.localUniforms;const a=i.gl,o=t.getBuffers(e);i.shader.bind(n),i.state.set(r),i.geometry.bind(o.geometry,n.glProgram);const c=o.geometry.indexBuffer.data.BYTES_PER_ELEMENT===2?a.UNSIGNED_SHORT:a.UNSIGNED_INT;a.drawElements(a.TRIANGLES,e.particleChildren.length*6,c,0)}}class aa{execute(t,e){const r=t.renderer,i=e.shader||t.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(e.texture);const n=t.state,a=t.getBuffers(e);r.encoder.draw({geometry:a.geometry,shader:e.shader||t.defaultShader,state:n,size:e.particleChildren.length*6})}}function Gr(s,t=null){const e=s*6;if(e>65535?t||(t=new Uint32Array(e)):t||(t=new Uint16Array(e)),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,i=0;r<e;r+=6,i+=4)t[r+0]=i+0,t[r+1]=i+1,t[r+2]=i+2,t[r+3]=i+0,t[r+4]=i+2,t[r+5]=i+3;return t}function oa(s){return{dynamicUpdate:Ar(s,!0),staticUpdate:Ar(s,!1)}}function Ar(s,t){const e=[];e.push(`

        var index = 0;

        for (let i = 0; i < ps.length; ++i)
        {
            const p = ps[i];

            `);let r=0;for(const n in s){const a=s[n];if(t!==a.dynamic)continue;e.push(`offset = index + ${r}`),e.push(a.code);const o=Pe(a.format);r+=o.stride/4}e.push(`
            index += stride * 4;
        }
    `),e.unshift(`
        var stride = ${r};
    `);const i=e.join(`
`);return new Function("ps","f32v","u32v",i)}class ha{constructor(t){this._size=0,this._generateParticleUpdateCache={};const e=this._size=t.size??1e3,r=t.properties;let i=0,n=0;for(const l in r){const d=r[l],f=Pe(d.format);d.dynamic?n+=f.stride:i+=f.stride}this._dynamicStride=n/4,this._staticStride=i/4,this.staticAttributeBuffer=new zt(e*4*i),this.dynamicAttributeBuffer=new zt(e*4*n),this.indexBuffer=Gr(e);const a=new Er;let o=0,h=0;this._staticBuffer=new vt({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:J.VERTEX|J.COPY_DST}),this._dynamicBuffer=new vt({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:J.VERTEX|J.COPY_DST});for(const l in r){const d=r[l],f=Pe(d.format);d.dynamic?(a.addAttribute(d.attributeName,{buffer:this._dynamicBuffer,stride:this._dynamicStride*4,offset:o*4,format:d.format}),o+=f.size):(a.addAttribute(d.attributeName,{buffer:this._staticBuffer,stride:this._staticStride*4,offset:h*4,format:d.format}),h+=f.size)}a.addIndex(this.indexBuffer);const c=this.getParticleUpdate(r);this._dynamicUpload=c.dynamicUpdate,this._staticUpload=c.staticUpdate,this.geometry=a}getParticleUpdate(t){const e=la(t);return this._generateParticleUpdateCache[e]?this._generateParticleUpdateCache[e]:(this._generateParticleUpdateCache[e]=this.generateParticleUpdate(t),this._generateParticleUpdateCache[e])}generateParticleUpdate(t){return oa(t)}update(t,e){t.length>this._size&&(e=!0,this._size=Math.max(t.length,this._size*1.5|0),this.staticAttributeBuffer=new zt(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new zt(this._size*this._dynamicStride*4*4),this.indexBuffer=Gr(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const r=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),e){const i=this.staticAttributeBuffer;this._staticUpload(t,i.float32View,i.uint32View),this._staticBuffer.setDataWithSize(i.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}function la(s){const t=[];for(const e in s){const r=s[e];t.push(e,r.code,r.dynamic?"d":"s")}return t.join("_")}var ca=`varying vec2 vUV;
varying vec4 vColor;

uniform sampler2D uTexture;

void main(void){
    vec4 color = texture2D(uTexture, vUV) * vColor;
    gl_FragColor = color;
}`,da=`attribute vec2 aVertex;
attribute vec2 aUV;
attribute vec4 aColor;

attribute vec2 aPosition;
attribute float aRotation;

uniform mat3 uTranslationMatrix;
uniform float uRound;
uniform vec2 uResolution;
uniform vec4 uColor;

varying vec2 vUV;
varying vec4 vColor;

vec2 roundPixels(vec2 position, vec2 targetSize)
{       
    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
}

void main(void){
    float cosRotation = cos(aRotation);
    float sinRotation = sin(aRotation);
    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;
    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;

    vec2 v = vec2(x, y);
    v = v + aPosition;

    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    if(uRound == 1.0)
    {
        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
    }

    vUV = aUV;
    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;
}
`,Fr=`
struct ParticleUniforms {
  uProjectionMatrix:mat3x3<f32>,
  uColor:vec4<f32>,
  uResolution:vec2<f32>,
  uRoundPixels:f32,
};

@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;

@group(1) @binding(0) var uTexture: texture_2d<f32>;
@group(1) @binding(1) var uSampler : sampler;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
  };
@vertex
fn mainVertex(
  @location(0) aVertex: vec2<f32>,
  @location(1) aPosition: vec2<f32>,
  @location(2) aUV: vec2<f32>,
  @location(3) aColor: vec4<f32>,
  @location(4) aRotation: f32,
) -> VSOutput {
  
   let v = vec2(
       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),
       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)
   ) + aPosition;

   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;

  return VSOutput(
   position,
   aUV,
   vColor,
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color: vec4<f32>,
  @builtin(position) position: vec4<f32>,
) -> @location(0) vec4<f32> {

    var sample = textureSample(uTexture, uSampler, uv) * color;
   
    return sample;
}`;class ua extends xt{constructor(){const t=di.from({vertex:da,fragment:ca}),e=ui.from({fragment:{source:Fr,entryPoint:"mainFragment"},vertex:{source:Fr,entryPoint:"mainVertex"}});super({glProgram:t,gpuProgram:e,resources:{uTexture:F.WHITE.source,uSampler:new gt({}),uniforms:{uTranslationMatrix:{value:new B,type:"mat3x3<f32>"},uColor:{value:new z(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class Ps{constructor(t,e){this.state=Nt.for2d(),this.localUniforms=new mt({uTranslationMatrix:{value:new B,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=e,this.defaultShader=new ua,this.state=Nt.for2d()}validateRenderable(t){return!1}addRenderable(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}getBuffers(t){return t._gpuData[this.renderer.uid]||this._initBuffer(t)}_initBuffer(t){return t._gpuData[this.renderer.uid]=new ha({size:t.particleChildren.length,properties:t._properties}),t._gpuData[this.renderer.uid]}updateRenderable(t){}execute(t){const e=t.particleChildren;if(e.length===0)return;const r=this.renderer,i=this.getBuffers(t);t.texture||(t.texture=e[0].texture);const n=this.state;i.update(e,t._childrenDirty),t._childrenDirty=!1,n.blendMode=De(t.blendMode,t.texture._source);const a=this.localUniforms.uniforms,o=a.uTranslationMatrix;t.worldTransform.copyTo(o),o.prepend(r.globalUniforms.globalUniformData.projectionMatrix),a.uResolution=r.globalUniforms.globalUniformData.resolution,a.uRound=r._roundPixels|t._roundPixels,le(t.groupColorAlpha,a.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class Ms extends Ps{constructor(t){super(t,new na)}}Ms.extension={type:[k.WebGLPipes],name:"particle"};class vs extends Ps{constructor(t){super(t,new aa)}}vs.extension={type:[k.WebGPUPipes],name:"particle"};const ks=class Rs extends ia{constructor(t={}){t={...Rs.defaultOptions,...t},super({width:t.width,height:t.height,verticesX:4,verticesY:4}),this.update(t)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=t.anchor?.x,this._anchorY=t.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:e,height:r,_leftWidth:i,_rightWidth:n,_topHeight:a,_bottomHeight:o,_anchorX:h,_anchorY:c}=this,l=i+n,d=e>l?1:e/l,f=a+o,u=r>f?1:r/f,g=Math.min(d,u),p=h*e,m=c*r;t[0]=t[8]=t[16]=t[24]=-p,t[2]=t[10]=t[18]=t[26]=i*g-p,t[4]=t[12]=t[20]=t[28]=e-n*g-p,t[6]=t[14]=t[22]=t[30]=e-p,t[1]=t[3]=t[5]=t[7]=-m,t[9]=t[11]=t[13]=t[15]=a*g-m,t[17]=t[19]=t[21]=t[23]=r-o*g-m,t[25]=t[27]=t[29]=t[31]=r-m,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const e=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};ks.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let ct=ks;const Bs=class Gs extends Ut{constructor(t){t instanceof F&&(t={texture:t});const{width:e,height:r,anchor:i,leftWidth:n,rightWidth:a,topHeight:o,bottomHeight:h,texture:c,roundPixels:l,...d}=t;super({label:"NineSliceSprite",...d}),this.renderPipeId="nineSliceSprite",this.batched=!0,this._leftWidth=n??c?.defaultBorders?.left??ct.defaultOptions.leftWidth,this._topHeight=o??c?.defaultBorders?.top??ct.defaultOptions.topHeight,this._rightWidth=a??c?.defaultBorders?.right??ct.defaultOptions.rightWidth,this._bottomHeight=h??c?.defaultBorders?.bottom??ct.defaultOptions.bottomHeight,this._width=e??c.width??ct.defaultOptions.width,this._height=r??c.height??ct.defaultOptions.height,this.allowChildren=!1,this.texture=c??Gs.defaultOptions.texture,this.roundPixels=l??!1,this._anchor=new O({_onUpdate:()=>{this.onViewUpdate()}}),i?this.anchor=i:this.texture.defaultAnchor&&(this.anchor=this.texture.defaultAnchor)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return this._width}set width(t){this._width=t,this.onViewUpdate()}get height(){return this._height}set height(t){this._height=t,this.onViewUpdate()}setSize(t,e){typeof t=="object"&&(e=t.height??t.width,t=t.width),this._width=t,this._height=e??t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this.onViewUpdate()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this.onViewUpdate()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this.onViewUpdate()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this.onViewUpdate()}get texture(){return this._texture}set texture(t){t||(t=F.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get originalWidth(){return this._texture.width}get originalHeight(){return this._texture.height}destroy(t){if(super.destroy(t),typeof t=="boolean"?t:t?.texture){const r=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(r)}this._texture=null}updateBounds(){const t=this._bounds,e=this._anchor,r=this._width,i=this._height;t.minX=-e._x*r,t.maxX=t.minX+r,t.minY=-e._y*i,t.maxY=t.minY+i}};Bs.defaultOptions={texture:F.EMPTY};let ja=Bs;class fa extends Ne{constructor(){super(),this.geometry=new ct}destroy(){this.geometry.destroy()}}class As{constructor(t){this._renderer=t}addRenderable(t,e){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}_updateBatchableSprite(t,e){e.geometry.update(t),e.setTexture(t._texture)}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=t._gpuData[this._renderer.uid]=new fa,r=e;return r.renderable=t,r.transform=t.groupTransform,r.texture=t._texture,r.roundPixels=this._renderer._roundPixels|t._roundPixels,t.didViewUpdate||this._updateBatchableSprite(t,r),e}destroy(){this._renderer=null}}As.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"nineSliceSprite"};const pa={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            }

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},ga={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;

        `,main:`
            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0

        `}};let be,we;class ma extends xt{constructor(){be??(be=se({name:"tiling-sprite-shader",bits:[$r,pa,ie]})),we??(we=ee({name:"tiling-sprite-shader",bits:[Ue,ga,re]}));const t=new mt({uMapCoord:{value:new B,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new B,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:we,gpuProgram:be,resources:{localUniforms:new mt({uTransformMatrix:{value:new B,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:F.EMPTY.source,uSampler:F.EMPTY.source.style}})}updateUniforms(t,e,r,i,n,a){const o=this.resources.tilingUniforms,h=a.width,c=a.height,l=a.textureMatrix,d=o.uniforms.uTextureTransform;d.set(r.a*h/t,r.b*h/e,r.c*c/t,r.d*c/e,r.tx/t,r.ty/e),d.invert(),o.uniforms.uMapCoord=l.mapCoord,o.uniforms.uClampFrame=l.uClampFrame,o.uniforms.uClampOffset=l.uClampOffset,o.uniforms.uTextureTransform=d,o.uniforms.uSizeAnchor[0]=t,o.uniforms.uSizeAnchor[1]=e,o.uniforms.uSizeAnchor[2]=i,o.uniforms.uSizeAnchor[3]=n,a&&(this.resources.uTexture=a.source,this.resources.uSampler=a.source.style)}}class xa extends Oe{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}function _a(s,t){const e=s.anchor.x,r=s.anchor.y;t[0]=-e*s.width,t[1]=-r*s.height,t[2]=(1-e)*s.width,t[3]=-r*s.height,t[4]=(1-e)*s.width,t[5]=(1-r)*s.height,t[6]=-e*s.width,t[7]=(1-r)*s.height}function ya(s,t,e,r){let i=0;const n=s.length/t,a=r.a,o=r.b,h=r.c,c=r.d,l=r.tx,d=r.ty;for(e*=t;i<n;){const f=s[e],u=s[e+1];s[e]=a*f+h*u+l,s[e+1]=o*f+c*u+d,e+=t,i++}}function ba(s,t){const e=s.texture,r=e.frame.width,i=e.frame.height;let n=0,a=0;s.applyAnchorToTexture&&(n=s.anchor.x,a=s.anchor.y),t[0]=t[6]=-n,t[2]=t[4]=1-n,t[1]=t[3]=-a,t[5]=t[7]=1-a;const o=B.shared;o.copyFrom(s._tileTransform.matrix),o.tx/=s.width,o.ty/=s.height,o.invert(),o.scale(s.width/r,s.height/i),ya(t,2,0,o)}const Ht=new xa;class wa{constructor(){this.canBatch=!0,this.geometry=new Oe({indices:Ht.indices.slice(),positions:Ht.positions.slice(),uvs:Ht.uvs.slice()})}destroy(){this.geometry.destroy(),this.shader?.destroy()}}class Fs{constructor(t){this._state=Nt.default2d,this._renderer=t}validateRenderable(t){const e=this._getTilingSpriteData(t),r=e.canBatch;this._updateCanBatch(t);const i=e.canBatch;if(i&&i===r){const{batchableMesh:n}=e;return!n._batcher.checkAndUpdateTexture(n,t.texture)}return r!==i}addRenderable(t,e){const r=this._renderer.renderPipes.batch;this._updateCanBatch(t);const i=this._getTilingSpriteData(t),{geometry:n,canBatch:a}=i;if(a){i.batchableMesh||(i.batchableMesh=new Ne);const o=i.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),o.geometry=n,o.renderable=t,o.transform=t.groupTransform,o.setTexture(t._texture)),o.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(o,e)}else r.break(e),i.shader||(i.shader=new ma),this.updateRenderable(t),e.add(t)}execute(t){const{shader:e}=this._getTilingSpriteData(t);e.groups[0]=this._renderer.globalUniforms.bindGroup;const r=e.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,le(t.groupColorAlpha,r.uColor,0),this._state.blendMode=De(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:Ht,shader:e,state:this._state})}updateRenderable(t){const e=this._getTilingSpriteData(t),{canBatch:r}=e;if(r){const{batchableMesh:i}=e;t.didViewUpdate&&this._updateBatchableMesh(t),i._batcher.updateElement(i)}else if(t.didViewUpdate){const{shader:i}=e;i.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}_getTilingSpriteData(t){return t._gpuData[this._renderer.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const e=new wa;return e.renderable=t,t._gpuData[this._renderer.uid]=e,e}_updateBatchableMesh(t){const e=this._getTilingSpriteData(t),{geometry:r}=e,i=t.texture.source.style;i.addressMode!=="repeat"&&(i.addressMode="repeat",i.update()),ba(t,r.uvs),_a(t,r.positions)}destroy(){this._renderer=null}_updateCanBatch(t){const e=this._getTilingSpriteData(t),r=t.texture;let i=!0;return this._renderer.type===jr.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),e.canBatch}}Fs.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"tilingSprite"};const Ta={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:`
            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));
        `}},Sa={name:"local-uniform-msdf-bit",vertex:{header:`
            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix *= uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `},fragment:{header:`
            uniform float uDistance;
         `,main:`
            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));
        `}},Ca={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {

                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));
                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);
                var coverage: f32 = pow(shapeColor.a * alpha, gamma);

                return coverage;

            }
        `}},Pa={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {

                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);

                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));
                float gamma = mix(1.0, 1.0 / 2.2, luma);
                float coverage = pow(shapeColor.a * alpha, gamma);

                return coverage;
            }
        `}};let Te,Se;class Ma extends xt{constructor(t){const e=new mt({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new B,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});Te??(Te=se({name:"sdf-shader",bits:[Hr,Nr(t),Ta,Ca,ie]})),Se??(Se=ee({name:"sdf-shader",bits:[Xr,Vr(t),Sa,Pa,re]})),super({glProgram:Se,gpuProgram:Te,resources:{localUniforms:e,batchSamplers:Or(t)}})}}class va extends te{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class Us{constructor(t){this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const r=this._getGpuBitmapText(t);Ur(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,e),r.context.customShader&&this._updateDistanceField(t)}updateRenderable(t){const e=this._getGpuBitmapText(t);Ur(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){const{context:r}=e,i=Zt.getFont(t.text,t._style);r.clear(),i.distanceField.type!=="none"&&(r.customShader||(r.customShader=new Ma(this._renderer.limits.maxBatchableTextures)));const n=q.graphemeSegmenter(t.text),a=t._style;let o=i.baseLineOffset;const h=ls(n,a,i,!0);let c=0;const l=a.padding,d=h.scale;let f=h.width,u=h.height+h.offsetY;a._stroke&&(f+=a._stroke.width/d,u+=a._stroke.width/d),r.translate(-t._anchor._x*f-l,-t._anchor._y*u-l).scale(d,d);const g=i.applyFillAsTint?a._fill.color:16777215;for(let p=0;p<h.lines.length;p++){const m=h.lines[p];for(let x=0;x<m.charPositions.length;x++){const _=n[c++],T=i.chars[_];T?.texture&&r.texture(T.texture,g||"black",Math.round(m.charPositions[x]+T.xOffset),Math.round(o+T.yOffset))}o+=i.lineHeight}}_getGpuBitmapText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new va;return t._gpuData[this._renderer.uid]=e,this._updateContext(t,e),e}_updateDistanceField(t){const e=this._getGpuBitmapText(t).context,r=t._style.fontFamily,i=$.get(`${r}-bitmap`),{a:n,b:a,c:o,d:h}=t.groupTransform,c=Math.sqrt(n*n+a*a),l=Math.sqrt(o*o+h*h),d=(Math.abs(c)+Math.abs(l))/2,f=i.baseRenderedFontSize/t._style.fontSize,u=d*i.distanceField.range*(1/f);e.customShader.resources.localUniforms.uniforms.uDistance=u}destroy(){this._renderer=null}}Us.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"bitmapText"};function Ur(s,t){t.groupTransform=s.groupTransform,t.groupColorAlpha=s.groupColorAlpha,t.groupColor=s.groupColor,t.groupBlendMode=s.groupBlendMode,t.globalDisplayStatus=s.globalDisplayStatus,t.groupTransform=s.groupTransform,t.localDisplayStatus=s.localDisplayStatus,t.groupAlpha=s.groupAlpha,t._roundPixels=s._roundPixels}class ka extends he{constructor(t){super(),this.generatingTexture=!1,this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.htmlText.returnTexturePromise(this.texturePromise),this.texturePromise=null,this._renderer=null}}function Fe(s,t){const{texture:e,bounds:r}=s;Lr(r,t._anchor,e);const i=t._style._getFinalPadding();r.minX-=i,r.minY-=i,r.maxX-=i,r.maxY-=i}class Ds{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,e){const r=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t).catch(i=>{}),t._didTextUpdate=!1,Fe(r,t)),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}async _updateGpuText(t){t._didTextUpdate=!1;const e=this._getGpuText(t);if(e.generatingTexture)return;e.texturePromise&&(this._renderer.htmlText.returnTexturePromise(e.texturePromise),e.texturePromise=null),e.generatingTexture=!0,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const r=this._renderer.htmlText.getTexturePromise(t);e.texturePromise=r,e.texture=await r;const i=t.renderGroup||t.parentRenderGroup;i&&(i.structureDidChange=!0),e.generatingTexture=!1,Fe(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new ka(this._renderer);return e.renderable=t,e.transform=t.groupTransform,e.texture=F.EMPTY,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}Ds.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"htmlText"};const Ra=new K;function Is(s,t,e,r){const i=Ra;i.minX=0,i.minY=0,i.maxX=s.width/r|0,i.maxY=s.height/r|0;const n=ut.getOptimalTexture(i.width,i.height,r,!1);return n.source.uploadMethodId="image",n.source.resource=s,n.source.alphaMode="premultiply-alpha-on-upload",n.frame.width=t/r,n.frame.height=e/r,n.source.emit("update",n.source),n.updateUvs(),n}function Ba(s,t){const e=t.fontFamily,r=[],i={},n=/font-family:([^;"\s]+)/g,a=s.match(n);function o(h){i[h]||(r.push(h),i[h]=!0)}if(Array.isArray(e))for(let h=0;h<e.length;h++)o(e[h]);else o(e);a&&a.forEach(h=>{const c=h.split(":")[1].trim();o(c)});for(const h in t.tagStyles){const c=t.tagStyles[h].fontFamily;o(c)}return r}async function Ga(s){const e=await(await st.get().fetch(s)).blob(),r=new FileReader;return await new Promise((n,a)=>{r.onloadend=()=>n(r.result),r.onerror=a,r.readAsDataURL(e)})}async function Dr(s,t){const e=await Ga(t);return`@font-face {
        font-family: "${s.fontFamily}";
        src: url('${e}');
        font-weight: ${s.fontWeight};
        font-style: ${s.fontStyle};
    }`}const Xt=new Map;async function Aa(s,t,e){const r=s.filter(i=>$.has(`${i}-and-url`)).map((i,n)=>{if(!Xt.has(i)){const{url:a}=$.get(`${i}-and-url`);n===0?Xt.set(i,Dr({fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:i},a)):Xt.set(i,Dr({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:i},a))}return Xt.get(i)});return(await Promise.all(r)).join(`
`)}function Fa(s,t,e,r,i){const{domElement:n,styleElement:a,svgRoot:o}=i;n.innerHTML=`<style>${t.cssStyle}</style><div style='padding:0;'>${s}</div>`,n.setAttribute("style",`transform: scale(${e});transform-origin: top left; display: inline-block`),a.textContent=r;const{width:h,height:c}=i.image;return o.setAttribute("width",h.toString()),o.setAttribute("height",c.toString()),new XMLSerializer().serializeToString(o)}function Ua(s,t){const e=yt.getOptimalCanvasAndContext(s.width,s.height,t),{context:r}=e;return r.clearRect(0,0,s.width,s.height),r.drawImage(s,0,0),e}function Da(s,t,e){return new Promise(async r=>{e&&await new Promise(i=>setTimeout(i,100)),s.onload=()=>{r()},s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(t)}`,s.crossOrigin="anonymous"})}class Ls{constructor(t){this._renderer=t,this._createCanvas=t.type===jr.WEBGPU}getTexture(t){return this.getTexturePromise(t)}getTexturePromise(t){return this._buildTexturePromise(t)}async _buildTexturePromise(t){const{text:e,style:r,resolution:i,textureStyle:n}=t,a=N.get(_s),o=Ba(e,r),h=await Aa(o,r,He.defaultTextStyle),c=Vn(e,r,h,a),l=Math.ceil(Math.ceil(Math.max(1,c.width)+r.padding*2)*i),d=Math.ceil(Math.ceil(Math.max(1,c.height)+r.padding*2)*i),f=a.image,u=2;f.width=(l|0)+u,f.height=(d|0)+u;const g=Fa(e,r,i,h,a);await Da(f,g,si()&&o.length>0);const p=f;let m;this._createCanvas&&(m=Ua(f,i));const x=Is(m?m.canvas:p,f.width-u,f.height-u,i);return n&&(x.source.style=n),this._createCanvas&&(this._renderer.texture.initSource(x.source),yt.returnCanvasAndContext(m)),N.return(a),x}returnTexturePromise(t){t.then(e=>{this._cleanUp(e)}).catch(()=>{X("HTMLTextSystem: Failed to clean texture")})}_cleanUp(t){ut.returnTexture(t,!0),t.source.resource=null,t.source.uploadMethodId="unknown"}destroy(){this._renderer=null}}Ls.extension={type:[k.WebGLSystem,k.WebGPUSystem,k.CanvasSystem],name:"htmlText"};class Ia extends he{constructor(t){super(),this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.canvasText.returnTexture(this.texture),this._renderer=null}}class Ws{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,e){const r=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t),t._didTextUpdate=!1),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t);e._batcher.updateElement(e)}_updateGpuText(t){const e=this._getGpuText(t);e.texture&&this._renderer.canvasText.returnTexture(e.texture),t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,e.texture=e.texture=this._renderer.canvasText.getTexture(t),Fe(e,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const e=new Ia(this._renderer);return e.renderable=t,e.transform=t.groupTransform,e.bounds={minX:0,maxX:1,minY:0,maxY:0},e.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=e,e}destroy(){this._renderer=null}}Ws.extension={type:[k.WebGLPipes,k.WebGPUPipes,k.CanvasPipes],name:"text"};class zs{constructor(t){this._renderer=t}getTexture(t,e,r,i){typeof t=="string"&&(U("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:r,resolution:e}),t.style instanceof Z||(t.style=new Z(t.style)),t.textureStyle instanceof gt||(t.textureStyle=new gt(t.textureStyle)),typeof t.text!="string"&&(t.text=t.text.toString());const{text:n,style:a,textureStyle:o}=t,h=t.resolution??this._renderer.resolution,{frame:c,canvasAndContext:l}=Bt.getCanvasAndContext({text:n,style:a,resolution:h}),d=Is(l.canvas,c.width,c.height,h);if(o&&(d.source.style=o),a.trim&&(c.pad(a.padding),d.frame.copyFrom(c),d.updateUvs()),a.filters){const f=this._applyFilters(d,a.filters);return this.returnTexture(d),Bt.returnCanvasAndContext(l),f}return this._renderer.texture.initSource(d._source),Bt.returnCanvasAndContext(l),d}returnTexture(t){const e=t.source;e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",ut.returnTexture(t,!0)}renderTextToCanvas(){U("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}_applyFilters(t,e){const r=this._renderer.renderTarget.renderTarget,i=this._renderer.filter.generateFilteredTexture({texture:t,filters:e});return this._renderer.renderTarget.bind(r,!1),i}destroy(){this._renderer=null}}zs.extension={type:[k.WebGLSystem,k.WebGPUSystem,k.CanvasSystem],name:"canvasText"};E.add(ws);E.add(Ee);E.add(Cs);E.add(Ms);E.add(vs);E.add(zs);E.add(Ws);E.add(Us);E.add(Ls);E.add(Ds);E.add(Fs);E.add(As);export{Be as A,$a as B,Ft as C,et as F,te as G,ja as N,Zn as R,qt as S,Ha as T,Na as a,Z as b,j as c,Xa as d,K as e,pi as f,Oa as g,Ti as h,ft as i,Ci as j,le as k,Va as l,H as m,ta as n,jn as o,Nn as p,Hn as q,On as r,ra as s,ea as t};
